import{f as $,g as c,af as j,u as J,ac as U,E as M,a1 as R,o as h,c as y,w as i,b as q,ai as w,Q as b,aj as P,a as u,h as G,au as V,d as I,av as W,j as _,aw as H}from"./index-b55a7827.js";import{Q as K}from"./QPage-615bd1f9.js";import{C as v}from"./QSpace-f8c655d3.js";import{u as X,a as S}from"./use-quasar-96558313.js";import{T as Y}from"./QTable-c3bf5ca2.js";import{a as m}from"./validationHelper-21a8e46b.js";import{u as Z,g as k}from"./userAuthStore-0c477450.js";import{_ as L}from"./CompactQTable-d15efe1b.js";import"./QMarkupTable-1fc170d9.js";import"./QList-f8bcfa4e.js";import"./QSelect-c33eb5ef.js";import"./QChip-1b4874fe.js";import"./QItemLabel-82cf5c84.js";import"./selection-af93f90a.js";import"./rtl-36dd996b.js";import"./format-6ceb96d6.js";const A={class:"w-full flex justify-end pb-3"},F={class:"relative overflow-x-auto shadow-md sm:rounded-lg"},ee=q("div",{class:"text-h6"},"Medium",-1),we={__name:"ShopView",setup(oe){const e=$({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,keywords:null,gte:null,lte:null,gtValue:null,ltValue:null,filterColumn:null,rangeColumn:null}),t=c(null),s=X(),g=Z(),d=c(!1),f=c(null),O=c(!1),o=j(),N=J(),B=a=>{e.keywords=a.keywords,e.gt=a.gt,e.lt=a.lt,e.gtValue=a.gtValue,e.ltValue=a.ltValue,e.filterColumn=a.filterColumn,e.rangeColumn=a.rangeColumn},x=a=>{e.page=a.page,e.rowsPerPage=a.rowsPerPage,e.descending=a.descending,e.sortBy=a.sortBy||"createdAt"},Q=a=>{N.push(`/dashboard/shop/shop_list/${a._id}`)},D=a=>{f.value=a._id,d.value=!0},p=async()=>{var r;const a={method:"GET",url:"api/shop/shop_lists",headers:{Authorization:`Bearer ${k("token")}`},params:{pageNumber:(e==null?void 0:e.page)||1,pageSize:(e==null?void 0:e.rowsPerPage)||10,descending:e==null?void 0:e.descending,sortBy:(e==null?void 0:e.sortBy)||"createdAt",select:" name address phone1 phone2 email website license note"}};e!=null&&e.keywords&&(a.params.keywords=e.keywords),e!=null&&e.gt&&(a.params.gt=e.gt),e!=null&&e.lt&&(a.params.lt=e.lt),m(e==null?void 0:e.gtValue)&&(a.params.gtValue=e.gtValue),m(e==null?void 0:e.ltValue)&&(a.params.ltValue=e.ltValue),e!=null&&e.filterColumn&&(a.params.filterColumn=e.filterColumn),e!=null&&e.rangeColumn&&(a.params.rangeColumn=e.rangeColumn),s.loading.show();try{const l=await S.request(a);t.value=l.data,s.loading.hide()}catch(l){console.log(l),s.loading.hide(),((r=l==null?void 0:l.response)==null?void 0:r.status)==401?s.notify({message:l.response.data.message+", Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):s.notify({message:l.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}};U(()=>{var a,r,l,n;o.query.hasOwnProperty("pageNumber")&&(e.pageNumber=Number((a=o.query)==null?void 0:a.pageNumber)),o.query.hasOwnProperty("pageSize")&&(e.pageSize=Number((r=o.query)==null?void 0:r.pageSize)),o.query.hasOwnProperty("descending")&&(e.descending=JSON.parse((l=o.query)==null?void 0:l.descending)),o.query.hasOwnProperty("sortBy")&&(e.sortBy=String((n=o.query)==null?void 0:n.sortBy)),o.query.hasOwnProperty("keywords")&&o.query.keywords&&o.query.keywords!=="null"&&(e.keywords=o.query.keywords),o.query.hasOwnProperty("gt")&&o.query.gt&&o.query.gt!=="null"&&(e.gt=String(o.query.gt)),o.query.hasOwnProperty("lt")&&o.query.lt&&o.query.lt!=="null"&&(e.lt=String(o.query.lt)),o.query.hasOwnProperty("gtValue")&&m(o.query.gtValue)&&(e.gtValue=Number(o.query.gtValue)),o.query.hasOwnProperty("ltValue")&&m(o.query.ltValue)&&(e.ltValue=Number(o.query.ltValue)),o.query.hasOwnProperty("filterColumn")&&o.query.filterColumn&&o.query.filterColumn!=="null"&&(e.filterColumn=String(o.query.filterColumn)),o.query.hasOwnProperty("rangeColumn")&&o.query.rangeColumn&&o.query.rangeColumn!=="null"&&(e.rangeColumn=String(o.query.rangeColumn)),p()}),M(e,R(p,1e3));const E=async()=>{var r;const a={method:"delete",url:"api/shop/shop_lists/"+f.value,headers:{Authorization:`Bearer ${k("token")}`}};try{s.loading.show(),await S.request(a);const l=t==null?void 0:t.value.shops.filter(n=>n._id!==f.value);t.value={...JSON.parse(JSON.stringify(t==null?void 0:t.value)),shops:l},(t==null?void 0:t.value.shops.length)<5&&(t==null?void 0:t.value.pages)!==1&&p(),s.loading.hide(),d.value=!1,s.notify({message:"Deleted successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(l){d.value=!1,((r=l==null?void 0:l.response)==null?void 0:r.status)==401?s.notify({message:l.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):s.notify({message:l.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),s.loading.hide(),console.error(l)}},z=[{name:"name",label:"Name",align:"left",field:"name",sortable:!0},{name:"address",label:"Address",align:"left",field:"address",sortable:!0},{name:"phone1",label:"Phone1",align:"left",field:"phone1",sortable:!0},{name:"phone2",label:"Phone2",align:"left",field:"phone2",sortable:!0},{name:"email",label:"Email",align:"left",field:"email",sortable:!0},{name:"website",label:"Website",align:"left",field:"website",sortable:!0},{name:"license",label:"License",align:"left",field:"license",sortable:!0},{name:"note",label:"Note",align:"left",field:"note",sortable:!0},{name:"action",label:"Action",field:"action"}];return(a,r)=>(h(),y(K,{padding:""},{default:i(()=>{var l,n,C;return[q("div",A,[w(g).checkShowOnPermission("createShop")?(h(),y(b,{key:0,style:{background:"green",color:"white"},label:"New Shop",to:"/dashboard/shop/shop_list/create"})):P("",!0)]),q("div",F,[u(L,{columns:z,"data-list":((l=t.value)==null?void 0:l.shops)||[],page:((n=t.value)==null?void 0:n.page)||1,pages:((C=t.value)==null?void 0:C.pages)||1,onUpdatePaginate:x,onOnEdit:Q,onOnDelete:D,onOnFilter:B,showEdit:w(g).checkShowOnPermission("editShop"),showDelete:w(g).checkShowOnPermission("deleteShop")},null,8,["data-list","page","pages","showEdit","showDelete"]),O.value?(h(),y(Y,{key:0})):P("",!0)]),u(H,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=T=>d.value=T)},{default:i(()=>[u(G,{style:{width:"300px","max-width":"80vw"}},{default:i(()=>[u(V,null,{default:i(()=>[ee]),_:1}),u(V,{class:"q-pt-none"},{default:i(()=>[I(" Are you sure you want to delete this shop? ")]),_:1}),u(W,{align:"right",class:"bg-white text-teal"},{default:i(()=>[_(u(b,{flat:"",label:"Cancel"},null,512),[[v]]),_(u(b,{flat:"",label:"Delete",onClick:E,color:"red"},null,512),[[v]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}};export{we as default};
