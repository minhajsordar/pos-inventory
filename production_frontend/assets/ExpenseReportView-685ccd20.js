import{f as T,g as c,af as $,u as R,ac as J,E as U,a1 as j,o as h,c as w,w as i,b as k,a as u,ai as q,aj as I,h as M,au as C,d as G,av as H,j as P,Q as V,aw as K}from"./index-b55a7827.js";import{Q as W}from"./QPage-615bd1f9.js";import{C as v}from"./QSpace-f8c655d3.js";import{u as X,a as b}from"./use-quasar-96558313.js";import{T as Y}from"./QTable-c3bf5ca2.js";import{a as m}from"./validationHelper-21a8e46b.js";import{u as Z,g as _}from"./userAuthStore-0c477450.js";import{_ as L}from"./ReportQTable-3214ce25.js";import"./QMarkupTable-1fc170d9.js";import"./QList-f8bcfa4e.js";import"./QSelect-c33eb5ef.js";import"./QChip-1b4874fe.js";import"./QItemLabel-82cf5c84.js";import"./selection-af93f90a.js";import"./rtl-36dd996b.js";import"./format-6ceb96d6.js";import"./jspdf.plugin.autotable-2f67a234.js";const A={class:"relative overflow-x-auto"},F=k("div",{class:"text-h6"},"Medium",-1),we={__name:"ExpenseReportView",setup(ee){const e=T({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,keywords:null,gte:null,lte:null,gtValue:null,ltValue:null,filterColumn:null,rangeColumn:null}),s=c(null),r=X(),y=Z(),d=c(!1),g=c(null),x=c(!1),t=$(),O=R(),S=a=>{e.keywords=a.keywords,e.gt=a.gt,e.lt=a.lt,e.gtValue=a.gtValue,e.ltValue=a.ltValue,e.filterColumn=a.filterColumn,e.rangeColumn=a.rangeColumn},N=a=>{e.page=a.page,e.rowsPerPage=a.rowsPerPage,e.descending=a.descending,e.sortBy=a.sortBy||"createdAt"},B=a=>{O.push(`/dashboard/expense/expense_lists/${a._id}`)},E=a=>{g.value=a._id,d.value=!0},p=async()=>{var l;const a={method:"GET",url:"api/expense/expense_lists",headers:{Authorization:`Bearer ${_("token")}`},params:{pageNumber:(e==null?void 0:e.page)||1,pageSize:(e==null?void 0:e.rowsPerPage)||10,descending:e==null?void 0:e.descending,sortBy:(e==null?void 0:e.sortBy)||"createdAt",report:!0}};e!=null&&e.keywords&&(a.params.keywords=e.keywords),e!=null&&e.gt&&(a.params.gt=e.gt),e!=null&&e.lt&&(a.params.lt=e.lt),m(e==null?void 0:e.gtValue)&&(a.params.gtValue=e.gtValue),m(e==null?void 0:e.ltValue)&&(a.params.ltValue=e.ltValue),e!=null&&e.filterColumn&&(a.params.filterColumn=e.filterColumn),e!=null&&e.rangeColumn&&(a.params.rangeColumn=e.rangeColumn),r.loading.show();try{const o=await b.request(a);s.value=o.data,r.loading.hide()}catch(o){console.log(o),r.loading.hide(),((l=o==null?void 0:o.response)==null?void 0:l.status)==401?r.notify({message:o.response.data.message+", Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):r.notify({message:o.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}};J(()=>{var a,l,o,n;t.query.hasOwnProperty("pageNumber")&&(e.pageNumber=Number((a=t.query)==null?void 0:a.pageNumber)),t.query.hasOwnProperty("pageSize")&&(e.pageSize=Number((l=t.query)==null?void 0:l.pageSize)),t.query.hasOwnProperty("descending")&&(e.descending=JSON.parse((o=t.query)==null?void 0:o.descending)),t.query.hasOwnProperty("sortBy")&&(e.sortBy=String((n=t.query)==null?void 0:n.sortBy)),t.query.hasOwnProperty("keywords")&&t.query.keywords&&t.query.keywords!=="null"&&(e.keywords=t.query.keywords),t.query.hasOwnProperty("gt")&&t.query.gt&&t.query.gt!=="null"&&(e.gt=String(t.query.gt)),t.query.hasOwnProperty("lt")&&t.query.lt&&t.query.lt!=="null"&&(e.lt=String(t.query.lt)),t.query.hasOwnProperty("gtValue")&&m(t.query.gtValue)&&(e.gtValue=Number(t.query.gtValue)),t.query.hasOwnProperty("ltValue")&&m(t.query.ltValue)&&(e.ltValue=Number(t.query.ltValue)),t.query.hasOwnProperty("filterColumn")&&t.query.filterColumn&&t.query.filterColumn!=="null"&&(e.filterColumn=String(t.query.filterColumn)),t.query.hasOwnProperty("rangeColumn")&&t.query.rangeColumn&&t.query.rangeColumn!=="null"&&(e.rangeColumn=String(t.query.rangeColumn)),p()}),U(e,j(p,1e3));const D=async()=>{var l;const a={method:"delete",url:"api/expense/expense_lists/"+g.value,headers:{Authorization:`Bearer ${_("token")}`}};try{r.loading.show(),await b.request(a);const o=s==null?void 0:s.value.expenses.filter(n=>n._id!==g.value);s.value={...JSON.parse(JSON.stringify(s==null?void 0:s.value)),expenses:o},(s==null?void 0:s.value.expenses.length)<5&&(s==null?void 0:s.value.pages)!==1&&p(),r.loading.hide(),d.value=!1,r.notify({message:"Deleted successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(o){d.value=!1,((l=o==null?void 0:o.response)==null?void 0:l.status)==401?r.notify({message:o.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):r.notify({message:o.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),r.loading.hide(),console.error(o)}},Q=[{name:"createdAt",label:"Invoice Date",align:"left",field:"createdAt",sortable:!0},{name:"amount",label:"Amount",align:"right",field:"amount",sortable:!0},{name:"paidAmount",label:"Paid amount",align:"right",field:"paidAmount",summery:!0},{name:"duePaidList",label:"Due paid list",align:"left",field:"duePaidList",sortable:!0},{name:"note",label:"Note",align:"left",field:"note",sortable:!0}];return(a,l)=>(h(),w(W,{padding:""},{default:i(()=>{var o,n,f;return[k("div",A,[u(L,{title:"Expense Report",columns:Q,"data-list":((o=s.value)==null?void 0:o.expenses)||[],page:((n=s.value)==null?void 0:n.page)||1,pages:((f=s.value)==null?void 0:f.pages)||1,onUpdatePaginate:N,onOnEdit:B,onOnDelete:E,onOnFilter:S,showEdit:q(y).checkShowOnPermission("editExpense"),showDelete:q(y).checkShowOnPermission("deleteExpense")},null,8,["data-list","page","pages","showEdit","showDelete"]),x.value?(h(),w(Y,{key:0})):I("",!0)]),u(K,{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=z=>d.value=z)},{default:i(()=>[u(M,{style:{width:"300px","max-width":"80vw"}},{default:i(()=>[u(C,null,{default:i(()=>[F]),_:1}),u(C,{class:"q-pt-none"},{default:i(()=>[G(" Are you sure you want to delete this expense? ")]),_:1}),u(H,{align:"right",class:"bg-white text-teal"},{default:i(()=>[P(u(V,{flat:"",label:"Cancel"},null,512),[[v]]),P(u(V,{flat:"",label:"Delete",onClick:D,color:"red"},null,512),[[v]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}};export{we as default};
