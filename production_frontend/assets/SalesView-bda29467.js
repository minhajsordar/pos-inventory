import{f as $,g,af as j,u as J,ac as U,E as I,a1 as M,o as w,c as q,w as c,b as C,ai as b,Q as P,aj as S,a as i,h as R,au as V,d as G,av as H,j as v,aw as K}from"./index-b55a7827.js";import{Q as W}from"./QPage-615bd1f9.js";import{C as _}from"./QSpace-f8c655d3.js";import{u as X,a as k}from"./use-quasar-96558313.js";import{T as Y}from"./QTable-c3bf5ca2.js";import{a as f}from"./validationHelper-21a8e46b.js";import{u as Z,g as O}from"./userAuthStore-0c477450.js";import{_ as A}from"./CompactQTable-d15efe1b.js";import"./QMarkupTable-1fc170d9.js";import"./QList-f8bcfa4e.js";import"./QSelect-c33eb5ef.js";import"./QChip-1b4874fe.js";import"./QItemLabel-82cf5c84.js";import"./selection-af93f90a.js";import"./rtl-36dd996b.js";import"./format-6ceb96d6.js";const L={class:"w-full flex justify-end pb-3"},F={class:"relative overflow-x-auto shadow-md sm:rounded-lg"},ee=C("div",{class:"text-h6"},"Medium",-1),we={__name:"SalesView",setup(te){const e=$({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,keywords:null,gte:null,lte:null,gtValue:null,ltValue:null,filterColumn:null,rangeColumn:null}),l=g(null),r=X(),y=Z(),d=g(!1),p=g(null),N=g(!1),t=j(),B=J(),x=o=>{e.keywords=o.keywords,e.gt=o.gt,e.lt=o.lt,e.gtValue=o.gtValue,e.ltValue=o.ltValue,e.filterColumn=o.filterColumn,e.rangeColumn=o.rangeColumn},D=o=>{e.page=o.page,e.rowsPerPage=o.rowsPerPage,e.descending=o.descending,e.sortBy=o.sortBy||"createdAt"},Q=o=>{B.push(`/dashboard/product_sale/product_sale_lists/${o._id}`)},z=o=>{p.value=o._id,d.value=!0},h=async()=>{var s;const o={method:"GET",url:"api/product_sale/product_sale_lists",headers:{Authorization:`Bearer ${O("token")}`},params:{pageNumber:(e==null?void 0:e.page)||1,pageSize:(e==null?void 0:e.rowsPerPage)||10,descending:e==null?void 0:e.descending,sortBy:(e==null?void 0:e.sortBy)||"createdAt",select:""}};e!=null&&e.keywords&&(o.params.keywords=e.keywords),e!=null&&e.gt&&(o.params.gt=e.gt),e!=null&&e.lt&&(o.params.lt=e.lt),f(e==null?void 0:e.gtValue)&&(o.params.gtValue=e.gtValue),f(e==null?void 0:e.ltValue)&&(o.params.ltValue=e.ltValue),e!=null&&e.filterColumn&&(o.params.filterColumn=e.filterColumn),e!=null&&e.rangeColumn&&(o.params.rangeColumn=e.rangeColumn),r.loading.show();try{const a=await k.request(o),u=a.data;u.productSales=u.productSales.map(n=>{if(typeof n.customer=="object"){const m={...n};return m.customer=n.customer.name+" >> "+n.customer.phone,m}else return n}),l.value=a.data,r.loading.hide()}catch(a){console.log(a),r.loading.hide(),((s=a==null?void 0:a.response)==null?void 0:s.status)==401?r.notify({message:a.response.data.message+", Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):r.notify({message:a.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}};U(()=>{var o,s,a,u;t.query.hasOwnProperty("pageNumber")&&(e.pageNumber=Number((o=t.query)==null?void 0:o.pageNumber)),t.query.hasOwnProperty("pageSize")&&(e.pageSize=Number((s=t.query)==null?void 0:s.pageSize)),t.query.hasOwnProperty("descending")&&(e.descending=JSON.parse((a=t.query)==null?void 0:a.descending)),t.query.hasOwnProperty("sortBy")&&(e.sortBy=String((u=t.query)==null?void 0:u.sortBy)),t.query.hasOwnProperty("keywords")&&t.query.keywords&&t.query.keywords!=="null"&&(e.keywords=t.query.keywords),t.query.hasOwnProperty("gt")&&t.query.gt&&t.query.gt!=="null"&&(e.gt=String(t.query.gt)),t.query.hasOwnProperty("lt")&&t.query.lt&&t.query.lt!=="null"&&(e.lt=String(t.query.lt)),t.query.hasOwnProperty("gtValue")&&f(t.query.gtValue)&&(e.gtValue=Number(t.query.gtValue)),t.query.hasOwnProperty("ltValue")&&f(t.query.ltValue)&&(e.ltValue=Number(t.query.ltValue)),t.query.hasOwnProperty("filterColumn")&&t.query.filterColumn&&t.query.filterColumn!=="null"&&(e.filterColumn=String(t.query.filterColumn)),t.query.hasOwnProperty("rangeColumn")&&t.query.rangeColumn&&t.query.rangeColumn!=="null"&&(e.rangeColumn=String(t.query.rangeColumn)),h()}),I(e,M(h,1e3));const E=async()=>{var s;const o={method:"delete",url:"api/product_sale/product_sale_lists/"+p.value,headers:{Authorization:`Bearer ${O("token")}`}};try{r.loading.show(),await k.request(o);const a=l==null?void 0:l.value.productSales.filter(u=>u._id!==p.value);l.value={...JSON.parse(JSON.stringify(l==null?void 0:l.value)),productSales:a},(l==null?void 0:l.value.productSales.length)<5&&(l==null?void 0:l.value.pages)!==1&&h(),r.loading.hide(),d.value=!1,r.notify({message:"Deleted successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(a){d.value=!1,((s=a==null?void 0:a.response)==null?void 0:s.status)==401?r.notify({message:a.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):r.notify({message:a.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),r.loading.hide(),console.error(a)}},T=[{name:"customer",label:"Customer",align:"left",field:"customer",sortable:!0},{name:"totalAmount",label:"Total Amount",align:"right",field:"totalAmount",sortable:!0},{name:"discount",label:"Discount",align:"right",field:"discount",sortable:!0},{name:"amount",label:"Amount After discount",align:"right",field:"amount",sortable:!0},{name:"paidAmount",label:"Paid Amount",align:"left",field:"paidAmount",sortable:!0},{name:"createdAt",label:"Invoice Date",align:"left",field:"createdAt",sortable:!0},{name:"action",label:"Action",field:"action"}];return(o,s)=>(w(),q(W,{padding:""},{default:c(()=>{var a,u,n;return[C("div",L,[b(y).checkShowOnPermission("createProductSale")?(w(),q(P,{key:0,style:{background:"green",color:"white"},label:"POS",to:"/dashboard/pos"})):S("",!0)]),C("div",F,[i(A,{columns:T,"data-list":((a=l.value)==null?void 0:a.productSales)||[],page:((u=l.value)==null?void 0:u.page)||1,pages:((n=l.value)==null?void 0:n.pages)||1,onUpdatePaginate:D,onOnEdit:Q,onOnDelete:z,onOnFilter:x,showEdit:b(y).checkShowOnPermission("editProductSale"),showDelete:b(y).checkShowOnPermission("deleteProductSale")},null,8,["data-list","page","pages","showEdit","showDelete"]),N.value?(w(),q(Y,{key:0})):S("",!0)]),i(K,{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=m=>d.value=m)},{default:c(()=>[i(R,{style:{width:"300px","max-width":"80vw"}},{default:c(()=>[i(V,null,{default:c(()=>[ee]),_:1}),i(V,{class:"q-pt-none"},{default:c(()=>[G(" Are you sure you want to delete this product_sale? ")]),_:1}),i(H,{align:"right",class:"bg-white text-teal"},{default:c(()=>[v(i(P,{flat:"",label:"Cancel"},null,512),[[_]]),v(i(P,{flat:"",label:"Delete",onClick:E,color:"red"},null,512),[[_]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}};export{we as default};
