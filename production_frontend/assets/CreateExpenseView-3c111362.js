import{af as we,u as Ae,g as r,f as se,E as ae,ac as Ne,o as p,c as G,w as m,b as t,a as n,au as L,d as H,Q as P,e as v,ag as le,ah as oe,ak as c,n as j,ai as $,h as I,aj as b,ax as T,j as Ve,R as Ee}from"./index-b55a7827.js";import{Q as ne}from"./QMarkupTable-1fc170d9.js";import{Q as Y}from"./QSelect-c33eb5ef.js";import{Q as Se}from"./QPage-615bd1f9.js";import{u as qe,a as Q}from"./use-quasar-96558313.js";import{u as Ce,g as F}from"./userAuthStore-0c477450.js";import"./QChip-1b4874fe.js";import"./QItemLabel-82cf5c84.js";import"./selection-af93f90a.js";import"./rtl-36dd996b.js";import"./format-6ceb96d6.js";const Le=t("div",{class:"p-0 text-h5 mb-2"}," Edit purchase ",-1),Pe={class:"flex flex-wrap -m-1"},Te={class:"w-3/5 p-1"},Be={class:"flex justify-between"},Oe=t("div",null,"Payment List",-1),De=t("thead",null,[t("tr",{class:"bg-grey-3"},[t("th",{class:"text-left"},"Bank Account"),t("th",{class:"text-right"},"Payment Type"),t("th",{class:"text-right"},"Amount"),t("th",{class:"text-right"},"Time"),t("th",{class:"text-right"},"Action")])],-1),Ue={class:"text-left"},Qe={class:"text-right"},Fe={class:"text-right"},Je={class:"text-right"},ze={class:"text-right"},Re=t("td",{class:"text-right",colspan:"2"},[t("span",{class:"text-h6"},"Due")],-1),je={class:"text-right",colspan:"1"},$e={class:"text-h6"},Ie=t("td",{class:"text-left",colspan:"2"},null,-1),We={class:"flex justify-between"},Me=t("div",null,"Expense Items",-1),Ge=t("thead",null,[t("tr",{class:"bg-grey-3"},[t("th",{class:"text-left"},"Name"),t("th",{class:"text-right"},"Expense Rate"),t("th",{class:"text-right"},"Quantity"),t("th",{class:"text-right"},"Total Price"),t("th",{class:"text-right"},"Selling Rate"),t("th",{class:"text-right"},"Action")])],-1),He={class:"text-left"},Ye={class:"text-right"},Ke={class:"text-right"},Xe={class:"text-right"},Ze={class:"text-right"},et={class:"text-right"},tt=t("td",{class:"text-right",colspan:"3"},[t("span",{class:"text-h6"},"Sub Total")],-1),st={class:"text-right"},at={class:"text-h6"},lt=t("td",{class:"text-left",colspan:"2"},null,-1),ot={class:"w-2/5 p-1"},nt=t("div",null,"Add/Edit Expense",-1),it={key:0,class:"text-red-8 text-xs q-pl-sm mb-6"},ut={class:"mb-6"},rt={key:0,class:"text-red-8 text-xs q-pl-sm"},ct={class:"mb-6"},dt={key:0,class:"text-red-8 text-xs q-pl-sm"},pt={class:"mb-6"},mt={key:0,class:"text-red-8 text-xs q-pl-sm"},ht={class:"mb-6"},vt=t("div",null,"Total",-1),gt={class:"mb-6"},yt={key:0,class:"text-red-8 text-xs q-pl-sm"},ft={class:"mb-6"},_t={key:0,class:"text-red-8 text-xs q-pl-sm"},bt={class:"mb-6"},xt={key:0,class:"text-red-8 text-xs q-pl-sm"},kt={class:"mb-6"},wt={class:"mb-6"},At={key:0,class:"mb-6"},Nt={key:0,class:"text-red-8 text-xs q-pl-sm"},Vt={class:"flex -m-1"},Et={class:"p-1"},St={class:"p-1"},zt={__name:"CreateExpenseView",setup(qt){const o=qe();Ce();const x=we(),K=Ae(),X=r([]),ie=r([]),d=r([]),ue=r([]),k=r([]),Z=r([]),w=r(null),A=r(1),N=r(1),z=r(1),B=r(1),_=r({}),h=r({}),D=r(null),y=r(0),V=r(0),W=r(0),U=r(null),J=r("Bank"),R=r(!1),O=r(null),ee=se({supplier:"",amount:"",paidAmount:"",duePaidList:"",quantity:"",unit:"",bankAccount:""}),re=se({supplier:"",amount:"",paidAmount:0,duePaidList:"",quantity:"",unit:"",bankAccount:""}),te=()=>{B.value=A.value*N.value},ce=()=>{var a;const l={};if(w.value||(l.expense="Required Field. Select a expense"),A.value||(l.price="Required Field. Must be greater than 0."),N.value||(l.quantity="Required Field. Must be greater than 0."),Object.keys(l).length>0){_.value=l;return}const s={name:w.value,price:A.value,quantity:N.value,unit:(a=w.value)==null?void 0:a.unit,total:B.value,sellingPrice:z.value},e=[...JSON.parse(JSON.stringify(d.value))];O.value!==null?e[O.value]={...e[O.value],...s}:e.push(s),_.value={},w.value=null,A.value=1,N.value=1,B.value=1,z.value=1,o.dialog({title:"Confirm",message:"Would you like to add new expense to this purchase?",ok:{push:!0},cancel:{push:!0,color:"negative"},persistent:!0}).onOk(()=>{d.value=e,O.value=null}).onCancel(()=>{}).onDismiss(()=>{})},de=l=>{const s=JSON.parse(JSON.stringify(d.value));s.splice(l,1),o.dialog({title:"Confirm",message:"Would you like to add new expense to this purchase?",ok:{push:!0},cancel:{push:!0,color:"negative"},persistent:!0}).onOk(()=>{ke(s)}).onCancel(()=>{}).onDismiss(()=>{})},pe=l=>{o.dialog({title:"Confirm",message:"Would you like to delete this payment?",ok:{push:!0},cancel:{push:!0,color:"negative"},persistent:!0}).onOk(()=>{const s=JSON.parse(JSON.stringify(k.value));s.splice(l,1),xe(s)}).onCancel(()=>{}).onDismiss(()=>{})},me=l=>{ie.value.forEach((s,e)=>{s._id==d.value[l].expense&&(s.value=s._id,s.label=s.name,w.value=s,O.value=l,R.value=!0,A.value=d.value[l].price,z.value=d.value[l].sellingPrice,N.value=d.value[l].quantity,B.value=d.value[l].total)})},he=()=>{O.value=null,R.value=!1},ve=()=>{O.value=null,R.value=!0,w.value=null,A.value=1,N.value=1,B.value=1,z.value=1};ae([d,k],()=>{console.log("updating"),y.value=d.value.reduce((l,s)=>Number(l)+Number(s.total),0)-k.value.reduce((l,s)=>Number(l)+Number(s.amount),0)}),ae([y,V,d,k],()=>{W.value=y.value-V.value}),Ne(()=>{ge(),ye(),fe()});const ge=async()=>{var s;const l={method:"GET",url:"api/supplier/supplier_lists",headers:{Authorization:`Bearer ${F("token")}`}};try{o.loading.show();const e=await Q.request(l);X.value=e.data.suppliers.map(a=>(a.label=a.companyName,a.value=a._id,D.value===a._id&&(D.value=a),a)),o.loading.hide()}catch(e){((s=e==null?void 0:e.response)==null?void 0:s.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},ye=async()=>{var s;const l={method:"GET",url:"api/unit/unit_lists",headers:{Authorization:`Bearer ${F("token")}`}};try{o.loading.show();const e=await Q.request(l);ue.value=e.data.units.map(a=>(a.label=a.value,a.value=a._id,ee.unit===a._id&&(ee.unit=a),a)),o.loading.hide()}catch(e){((s=e==null?void 0:e.response)==null?void 0:s.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},fe=async()=>{var s;const l={method:"GET",url:"api/bank_account/bank_account_lists",headers:{Authorization:`Bearer ${F("token")}`}};try{o.loading.show();const e=await Q.request(l);Z.value=e.data.bankAccounts.map(a=>(a.label=a.name,a.value=a._id,U.value===a._id&&(U.value=a),a)),o.loading.hide()}catch(e){((s=e==null?void 0:e.response)==null?void 0:s.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},_e=()=>{V.value=Number(y.value)},be=async l=>{var i,g,E,S,q,C,u;l.preventDefault(),h.value={};const s={};(i=D.value)!=null&&i._id?s.supplier=(g=D.value)==null?void 0:g._id:h.value.supplier="Please Select A Supplier.",y.value||(h.value.amount="You don't have any due amount"),Number(y.value)<Number(V.value)&&(h.value.payAmount="Amount can't be greater than due amount"),s.paidAmount=Number(V.value)+Number(k.value.reduce((f,M)=>Number(f)+Number(M.amount),0)),J.value=="Bank"&&!((E=U.value)!=null&&E._id)&&(h.value.bankAccount="Please Select Bank Account.");const e={amount:V.value,type:J.value,bankAccount:(S=U.value)==null?void 0:S._id,time:new Date};if(s.paymentDetails=JSON.stringify([...JSON.parse(JSON.stringify(k.value)),e]),s.itemList=JSON.stringify(d.value),s.amount=d.value.reduce((f,M)=>Number(f)+Number(M.total),0),Object.keys(h.value).length!==0)return;if(console.log(s),Object.keys(s).length<=0){o.notify({message:"Empty Form Submission Not Allowed",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]});return}const a={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${F("token")}`},data:s};x.params.id=="create"?(a.method="post",a.url="api/expense/expense_lists"):(a.method="put",a.url="api/expense/expense_lists/"+x.params.id);try{const f=await Q.request(a);(q=x.query)!=null&&q.redirect?K.push(`/${(C=x.query)==null?void 0:C.redirect}`):K.push("/dashboard/expense/expense_list"),o.notify({message:"Updated Successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(f){((u=f==null?void 0:f.response)==null?void 0:u.status)==401?o.notify({message:f.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:f.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),console.error(f)}},xe=async l=>{var a;const s={};if(s.paidAmount=Number(l.reduce((i,g)=>Number(i)+Number(g.amount),0)),s.paymentDetails=JSON.stringify(l),Object.keys(s).length<=0){o.notify({message:"Empty Form Submission Not Allowed",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]});return}const e={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${F("token")}`},data:s};x.params.id=="create"?(e.method="post",e.url="api/expense/expense_lists"):(e.method="put",e.url="api/expense/expense_lists/"+x.params.id);try{const i=await Q.request(e);o.notify({message:"Updated Successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(i){((a=i==null?void 0:i.response)==null?void 0:a.status)==401?o.notify({message:i.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:i.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),console.error(i)}finally{await getExpense()}},ke=async l=>{var a;const s={};if(s.itemList=JSON.stringify(l),s.amount=l.reduce((i,g)=>Number(i)+Number(g.total),0),Object.keys(s).length<=0){o.notify({message:"Empty Form Submission Not Allowed",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]});return}const e={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${F("token")}`},data:s};x.params.id=="create"?(e.method="post",e.url="api/expense/expense_lists"):(e.method="put",e.url="api/expense/expense_lists/"+x.params.id);try{const i=await Q.request(e);o.notify({message:"Updated Successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(i){((a=i==null?void 0:i.response)==null?void 0:a.status)==401?o.notify({message:i.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:i.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),console.error(i)}finally{await getExpense()}};return(l,s)=>(p(),G(Se,{padding:""},{default:m(()=>[Le,t("div",Pe,[t("div",Te,[n(I,{flat:"",bordered:"",class:j(["my-card mb-2",[$(o).dark.isActive?"bg-grey-9":"bg-grey-2",y.value==0?"opacity-60 pointer-events-none":""]])},{default:m(()=>[n(L,{class:"q-pb-none text-h6"},{default:m(()=>[t("div",Be,[Oe,H(),n(P,{onClick:he,label:"Add Payment",color:"orange"})])]),_:1}),n(L,null,{default:m(()=>[t("div",null,[n(ne,{separator:"cell",flat:"",bordered:""},{default:m(()=>[De,t("tbody",null,[(p(!0),v(oe,null,le(k.value,(e,a)=>(p(),v("tr",null,[t("td",Ue,c(e==null?void 0:e.bankAccount),1),t("td",Qe,c(e==null?void 0:e.type),1),t("td",Fe,c(e==null?void 0:e.amount),1),t("td",Je,c(e==null?void 0:e.time),1),t("td",ze,[n(P,{icon:"delete",color:"red",flat:"",dense:"",size:"md",onClick:()=>pe(a)},null,8,["onClick"])])]))),256)),t("tr",null,[Re,t("td",je,[t("span",$e,c(Number(re.amount)-k.value.reduce((e,a)=>Number(e)+Number(a.amount),0)),1)]),Ie])])]),_:1})])]),_:1})]),_:1},8,["class"]),n(I,{flat:"",bordered:"",class:j(["my-card",$(o).dark.isActive?"bg-grey-9":"bg-grey-2"])},{default:m(()=>[n(L,{class:"q-pb-none text-h6"},{default:m(()=>[t("div",We,[Me,H(),n(P,{onClick:ve,label:"Add Item",color:"orange"})])]),_:1}),n(L,null,{default:m(()=>[t("div",null,[n(ne,{separator:"cell",flat:"",bordered:""},{default:m(()=>[Ge,t("tbody",null,[(p(!0),v(oe,null,le(d.value,(e,a)=>(p(),v("tr",null,[t("td",He,[H(c(e==null?void 0:e.name)+" ",1),n(T,{"model-value":d.value[a].name,"onUpdate:modelValue":i=>d.value[a].name=i,flat:"",borderless:""},null,8,["model-value","onUpdate:modelValue"])]),t("td",Ye,c(e==null?void 0:e.price),1),t("td",Ke,c(e==null?void 0:e.quantity),1),t("td",Xe,c(e==null?void 0:e.total),1),t("td",Ze,c(e==null?void 0:e.sellingPrice),1),t("td",et,[n(P,{icon:"edit",color:"green",flat:"",dense:"",size:"md",onClick:()=>me(a)},null,8,["onClick"]),n(P,{icon:"delete",color:"red",flat:"",dense:"",size:"md",onClick:()=>de(a)},null,8,["onClick"])])]))),256)),t("tr",null,[tt,t("td",st,[t("span",at,c(d.value.reduce((e,a)=>Number(e)+Number(a.total),0)),1)]),lt])])]),_:1})])]),_:1})]),_:1},8,["class"])]),t("div",ot,[R.value?(p(),G(I,{key:0,flat:"",bordered:"",class:j(["my-card mb-2",$(o).dark.isActive?"bg-grey-9":"bg-grey-2"])},{default:m(()=>[n(L,{class:"q-pb-none text-h6"},{default:m(()=>[nt]),_:1}),n(L,null,{default:m(()=>{var e,a,i,g,E,S,q,C;return[t("div",null,[(e=_.value)!=null&&e.headerWarning?(p(),v("div",it,[t("span",null,c((a=_.value)==null?void 0:a.headerWarning),1)])):b("",!0),t("div",ut,[n(T,{label:"Item name ",placeholder:"Expense item name",modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=u=>w.value=u),outlined:"",dense:""},null,8,["modelValue"]),(i=_.value)!=null&&i.expense?(p(),v("div",rt,[t("span",null,c((g=_.value)==null?void 0:g.expense),1)])):b("",!0)]),t("div",ct,[n(T,{label:"Expense Rate *",type:"number",placeholder:"Expense Rate",modelValue:A.value,"onUpdate:modelValue":[s[1]||(s[1]=u=>A.value=u),te],outlined:"",dense:""},null,8,["modelValue"]),(E=_.value)!=null&&E.price?(p(),v("div",dt,[t("span",null,c((S=_.value)==null?void 0:S.price),1)])):b("",!0)]),t("div",pt,[n(T,{label:"Quantity *",type:"number",placeholder:"Quantity",modelValue:N.value,"onUpdate:modelValue":[s[2]||(s[2]=u=>N.value=u),te],outlined:"",dense:""},null,8,["modelValue"]),(q=_.value)!=null&&q.quantity?(p(),v("div",mt,[t("span",null,c((C=_.value)==null?void 0:C.quantity),1)])):b("",!0)]),t("div",ht,[n(T,{label:"Total *",type:"number",placeholder:"Total",modelValue:B.value,"onUpdate:modelValue":s[3]||(s[3]=u=>B.value=u),outlined:"",disable:"",dense:""},null,8,["modelValue"])]),n(P,{label:"Add To Cart",color:"green",onClick:ce})])]}),_:1})]),_:1},8,["class"])):(p(),G(I,{key:1,flat:"",bordered:"",class:j(["my-card",[$(o).dark.isActive?"bg-grey-9":"bg-grey-2",y.value==0?"opacity-60 pointer-events-none":""]])},{default:m(()=>[n(L,{class:"q-pb-none text-h6"},{default:m(()=>[vt]),_:1}),n(L,null,{default:m(()=>{var e,a,i,g,E,S,q,C;return[t("div",null,[t("div",gt,[n(Y,{label:"Select an option for Supplier ",placeholder:"Value",modelValue:D.value,"onUpdate:modelValue":s[4]||(s[4]=u=>D.value=u),options:X.value,outlined:"",dense:""},null,8,["modelValue","options"]),(e=h.value)!=null&&e.supplier?(p(),v("div",yt,[t("span",null,c((a=h.value)==null?void 0:a.supplier),1)])):b("",!0)]),t("div",ft,[n(T,{label:"Amount *",type:"number",placeholder:"Amount",modelValue:y.value,"onUpdate:modelValue":s[5]||(s[5]=u=>y.value=u),outlined:"",dense:"",disable:""},null,8,["modelValue"]),(i=h.value)!=null&&i.amount?(p(),v("div",_t,[t("span",null,c((g=h.value)==null?void 0:g.amount),1)])):b("",!0)]),t("div",bt,[n(T,{label:"Pay amount *",type:"number",placeholder:"Paid amount",modelValue:V.value,"onUpdate:modelValue":s[6]||(s[6]=u=>V.value=u),outlined:"",dense:""},null,8,["modelValue"]),(E=h.value)!=null&&E.payAmount?(p(),v("div",xt,[t("span",null,c((S=h.value)==null?void 0:S.payAmount),1)])):b("",!0)]),t("div",kt,[n(T,{label:"Due ",type:"text",placeholder:"Due",modelValue:W.value,"onUpdate:modelValue":s[7]||(s[7]=u=>W.value=u),outlined:"",dense:"",disable:""},null,8,["modelValue"])]),t("div",wt,[n(Y,{label:"Payment Type ",options:["Bank","Cash"],placeholder:"Due",modelValue:J.value,"onUpdate:modelValue":s[8]||(s[8]=u=>J.value=u),outlined:"",dense:""},null,8,["modelValue"])]),J.value=="Bank"?(p(),v("div",At,[n(Y,{label:"Select an option for Bank account ",placeholder:"Value",modelValue:U.value,"onUpdate:modelValue":s[9]||(s[9]=u=>U.value=u),options:Z.value,outlined:"",dense:""},null,8,["modelValue","options"]),(q=h.value)!=null&&q.bankAccount?(p(),v("div",Nt,[t("span",null,c((C=h.value)==null?void 0:C.bankAccount),1)])):b("",!0)])):b("",!0),Ve(t("div",Vt,[t("div",Et,[n(P,{label:"Full Payment",color:"cyan",onClick:_e})]),t("div",St,[n(P,{label:l.$route.params.id==="create"?"Create Expense":"Update Expense",color:"green",onClick:be},null,8,["label"])])],512),[[Ee,y.value!==0]])])]}),_:1})]),_:1},8,["class"]))])])]),_:1}))}};export{zt as default};
