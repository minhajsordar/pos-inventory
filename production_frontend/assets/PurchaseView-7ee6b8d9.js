import{f as T,g as p,af as $,u as j,ac as J,E as U,a1 as M,o as w,c as q,w as i,b,ai as P,Q as C,aj as V,a as n,h as R,au as v,d as G,av as H,j as _,aw as K}from"./index-1afe7156.js";import{Q as W}from"./QPage-dbe3b711.js";import{C as k}from"./QSpace-f97a4fcb.js";import{u as X,a as O}from"./use-quasar-7dcfde9a.js";import{T as Y}from"./QTable-78fe1a21.js";import{a as g}from"./validationHelper-21a8e46b.js";import{u as Z,g as S}from"./userAuthStore-bea79ead.js";import{_ as L}from"./CompactQTable-172aecc4.js";import"./QMarkupTable-a0c3ed8d.js";import"./QList-887f05d5.js";import"./QSelect-38e1999a.js";import"./QChip-67221c42.js";import"./QItemLabel-80fbf0da.js";import"./selection-d27bdc72.js";import"./rtl-36dd996b.js";import"./format-6ceb96d6.js";const A={class:"w-full flex justify-end pb-3"},F={class:"relative overflow-x-auto shadow-md sm:rounded-lg"},ee=b("div",{class:"text-h6"},"Medium",-1),we={__name:"PurchaseView",setup(ae){const e=T({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,keywords:null,gte:null,lte:null,gtValue:null,ltValue:null,filterColumn:null,rangeColumn:null}),o=p(null),l=X(),y=Z(),c=p(!1),h=p(null),N=p(!1),a=$(),B=j(),x=s=>{e.keywords=s.keywords,e.gt=s.gt,e.lt=s.lt,e.gtValue=s.gtValue,e.ltValue=s.ltValue,e.filterColumn=s.filterColumn,e.rangeColumn=s.rangeColumn},Q=s=>{e.page=s.page,e.rowsPerPage=s.rowsPerPage,e.descending=s.descending,e.sortBy=s.sortBy||"createdAt"},D=s=>{B.push(`/dashboard/purchase/purchase_list/${s._id}`)},z=s=>{h.value=s._id,c.value=!0},f=async()=>{var u;const s={method:"GET",url:"api/purchase/purchase_lists",headers:{Authorization:`Bearer ${S("token")}`},params:{pageNumber:(e==null?void 0:e.page)||1,pageSize:(e==null?void 0:e.rowsPerPage)||10,descending:e==null?void 0:e.descending,sortBy:(e==null?void 0:e.sortBy)||"createdAt",select:" supplier amount paidAmount purchaseId"}};e!=null&&e.keywords&&(s.params.keywords=e.keywords),e!=null&&e.gt&&(s.params.gt=e.gt),e!=null&&e.lt&&(s.params.lt=e.lt),g(e==null?void 0:e.gtValue)&&(s.params.gtValue=e.gtValue),g(e==null?void 0:e.ltValue)&&(s.params.ltValue=e.ltValue),e!=null&&e.filterColumn&&(s.params.filterColumn=e.filterColumn),e!=null&&e.rangeColumn&&(s.params.rangeColumn=e.rangeColumn),l.loading.show();try{const r=await O.request(s);r.data.purchases=r.data.purchases.map(t=>{var d,m;return(d=t.supplier)!=null&&d.companyName&&(t.supplier=(m=t.supplier)==null?void 0:m.companyName),t}),o.value=r.data,l.loading.hide()}catch(r){console.log(r),l.loading.hide(),((u=r==null?void 0:r.response)==null?void 0:u.status)==401?l.notify({message:r.response.data.message+", Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):l.notify({message:r.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}};J(()=>{var s,u,r,t;a.query.hasOwnProperty("pageNumber")&&(e.pageNumber=Number((s=a.query)==null?void 0:s.pageNumber)),a.query.hasOwnProperty("pageSize")&&(e.pageSize=Number((u=a.query)==null?void 0:u.pageSize)),a.query.hasOwnProperty("descending")&&(e.descending=JSON.parse((r=a.query)==null?void 0:r.descending)),a.query.hasOwnProperty("sortBy")&&(e.sortBy=String((t=a.query)==null?void 0:t.sortBy)),a.query.hasOwnProperty("keywords")&&a.query.keywords&&a.query.keywords!=="null"&&(e.keywords=a.query.keywords),a.query.hasOwnProperty("gt")&&a.query.gt&&a.query.gt!=="null"&&(e.gt=String(a.query.gt)),a.query.hasOwnProperty("lt")&&a.query.lt&&a.query.lt!=="null"&&(e.lt=String(a.query.lt)),a.query.hasOwnProperty("gtValue")&&g(a.query.gtValue)&&(e.gtValue=Number(a.query.gtValue)),a.query.hasOwnProperty("ltValue")&&g(a.query.ltValue)&&(e.ltValue=Number(a.query.ltValue)),a.query.hasOwnProperty("filterColumn")&&a.query.filterColumn&&a.query.filterColumn!=="null"&&(e.filterColumn=String(a.query.filterColumn)),a.query.hasOwnProperty("rangeColumn")&&a.query.rangeColumn&&a.query.rangeColumn!=="null"&&(e.rangeColumn=String(a.query.rangeColumn)),f()}),U(e,M(f,1e3));const E=async()=>{var u;const s={method:"delete",url:"api/purchase/purchase_lists/"+h.value,headers:{Authorization:`Bearer ${S("token")}`}};try{l.loading.show(),await O.request(s);const r=o==null?void 0:o.value.purchases.filter(t=>t._id!==h.value);o.value={...JSON.parse(JSON.stringify(o==null?void 0:o.value)),purchases:r},(o==null?void 0:o.value.purchases.length)<5&&(o==null?void 0:o.value.pages)!==1&&f(),l.loading.hide(),c.value=!1,l.notify({message:"Deleted successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(r){c.value=!1,((u=r==null?void 0:r.response)==null?void 0:u.status)==401?l.notify({message:r.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):l.notify({message:r.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),l.loading.hide(),console.error(r)}},I=[{name:"supplier",label:"Supplier",align:"left",field:"supplier",sortable:!0},{name:"amount",label:"Amount",align:"right",field:"amount",sortable:!0},{name:"paidAmount",label:"Paid amount",align:"right",field:"paidAmount",sortable:!0},{name:"purchaseId",label:"Invoice no",align:"right",field:"purchaseId",sortable:!0},{name:"action",label:"Action",field:"action"}];return(s,u)=>(w(),q(W,{padding:""},{default:i(()=>{var r,t,d;return[b("div",A,[P(y).checkShowOnPermission("createPurchase")?(w(),q(C,{key:0,style:{background:"green",color:"white"},label:"New Purchase",to:"/dashboard/purchase/purchase_list/create"})):V("",!0)]),b("div",F,[n(L,{columns:I,"data-list":((r=o.value)==null?void 0:r.purchases)||[],page:((t=o.value)==null?void 0:t.page)||1,pages:((d=o.value)==null?void 0:d.pages)||1,onUpdatePaginate:Q,onOnEdit:D,onOnDelete:z,onOnFilter:x,showEdit:P(y).checkShowOnPermission("editPurchase"),showDelete:P(y).checkShowOnPermission("deletePurchase")},null,8,["data-list","page","pages","showEdit","showDelete"]),N.value?(w(),q(Y,{key:0})):V("",!0)]),n(K,{modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=m=>c.value=m)},{default:i(()=>[n(R,{style:{width:"300px","max-width":"80vw"}},{default:i(()=>[n(v,null,{default:i(()=>[ee]),_:1}),n(v,{class:"q-pt-none"},{default:i(()=>[G(" Are you sure you want to delete this purchase? ")]),_:1}),n(H,{align:"right",class:"bg-white text-teal"},{default:i(()=>[_(n(C,{flat:"",label:"Cancel"},null,512),[[k]]),_(n(C,{flat:"",label:"Delete",onClick:E,color:"red"},null,512),[[k]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}};export{we as default};
