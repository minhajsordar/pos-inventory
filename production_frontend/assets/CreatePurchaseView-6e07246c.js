import{af as de,u as ce,g as u,f as Y,E as Z,ac as pe,o as p,c as me,w as _,b as t,a as s,au as L,e as f,ak as r,aj as V,ax as P,Q as F,n as J,ai as $,h as M,ag as ve,ah as he}from"./index-1afe7156.js";import{Q as z}from"./QSelect-38e1999a.js";import{Q as ge}from"./QMarkupTable-a0c3ed8d.js";import{Q as ye}from"./QPage-dbe3b711.js";import{u as _e,a as E}from"./use-quasar-7dcfde9a.js";import{u as fe,g as O}from"./userAuthStore-bea79ead.js";import{n as be}from"./validationHelper-21a8e46b.js";import"./QChip-67221c42.js";import"./QItemLabel-80fbf0da.js";import"./selection-d27bdc72.js";import"./rtl-36dd996b.js";import"./format-6ceb96d6.js";const xe=t("div",{class:"p-0 text-h5 mb-2"}," Add new purchase ",-1),ke={class:"flex flex-wrap -m-1"},Ve={class:"w-3/5 p-1"},we=t("div",null,"Buy Product",-1),Ae={key:0,class:"text-red-8 text-xs q-pl-sm mb-6"},Pe={class:"mb-6"},qe={key:0,class:"text-red-8 text-xs q-pl-sm"},Se={class:"mb-6"},Ne={key:0,class:"text-red-8 text-xs q-pl-sm"},Be={class:"mb-6"},Le={key:0,class:"text-red-8 text-xs q-pl-sm"},Te={class:"mb-6"},Ce={class:"mb-6"},Qe={key:0,class:"text-red-8 text-xs q-pl-sm"},Ue=t("div",null,"Cart List",-1),De=t("thead",null,[t("tr",{class:"bg-grey-3"},[t("th",{class:"text-left"},"Name"),t("th",{class:"text-right"},"Purchase Rate"),t("th",{class:"text-right"},"Quantity"),t("th",{class:"text-right"},"Total Price"),t("th",{class:"text-right"},"Selling Rate"),t("th",{class:"text-right"},"Action")])],-1),Ee={class:"text-left"},Oe={class:"text-right"},Re={class:"text-right"},Fe={class:"text-right"},ze={class:"text-right"},Je={class:"text-right"},$e=t("td",{class:"text-right",colspan:"3"},[t("span",{class:"text-h6"},"Sub Total")],-1),Me={class:"text-right"},je={class:"text-h6"},Ge=t("td",{class:"text-left",colspan:"2"},null,-1),We={class:"w-2/5 p-1"},He=t("div",null,"Total",-1),Ie={class:"mb-6"},Ke={key:0,class:"text-red-8 text-xs q-pl-sm"},Xe={class:"mb-6"},Ye={key:0,class:"text-red-8 text-xs q-pl-sm"},Ze={class:"mb-6"},et={class:"mb-6"},tt={class:"mb-6"},at={key:0,class:"mb-6"},lt={key:0,class:"text-red-8 text-xs q-pl-sm"},ot={class:"flex -m-1"},st={class:"p-1"},nt={class:"p-1"},bt={__name:"CreatePurchaseView",setup(ut){const o=_e();fe();const j=de(),G=ce(),W=u([]),H=u([]),m=u([]),ee=u([]),te=u([]),I=u([]),w=u(null),q=u(1),S=u(1),T=u(1),C=u(1),d=u({}),c=u({}),N=u(null),v=u(0),A=u(0),R=u(0),B=u(null),Q=u("Bank"),K=Y({supplier:"",amount:"",paidAmount:"",duePaidList:"",quantity:"",unit:"",bankAccount:""});Y({supplier:"",amount:"",paidAmount:"",duePaidList:"",quantity:"",unit:"",bankAccount:""});const X=()=>{C.value=q.value*S.value},ae=()=>{var l,h,g;const n={};if(w.value||(n.product="Required Field. Select a product"),q.value||(n.price="Required Field. Must be greater than 0."),S.value||(n.quantity="Required Field. Must be greater than 0."),T.value||(n.sellingPrice="Required Field. Must be greater than purchase rate."),m.value.some(b=>{var y;return b.product===((y=w.value)==null?void 0:y._id)})&&(n.product="Product Already Added. To add again remove from below list."),Object.keys(n).length>0){d.value=n;return}const e={product:(l=w.value)==null?void 0:l._id,name:(h=w.value)==null?void 0:h.name,price:q.value,quantity:S.value,unit:(g=w.value)==null?void 0:g.unit,total:C.value,sellingPrice:T.value};m.value=[...JSON.parse(JSON.stringify(m.value)),e],d.value={},w.value=null,q.value=1,S.value=1,C.value=1,T.value=1},le=n=>{const a=JSON.parse(JSON.stringify(m.value));a.splice(n,1),m.value=a};Z(m,()=>{console.log("updating"),v.value=m.value.reduce((n,a)=>Number(n)+Number(a.price),0)}),Z([v,A,m],()=>{R.value=v.value-A.value}),pe(()=>{oe(),ne(),ue(),se()});const oe=async()=>{var a;const n={method:"GET",url:"api/supplier/supplier_lists",headers:{Authorization:`Bearer ${O("token")}`}};try{o.loading.show();const e=await E.request(n);W.value=e.data.suppliers.map(l=>(l.label=l.companyName,l.value=l._id,N.value===l._id&&(N.value=l),l)),o.loading.hide()}catch(e){((a=e==null?void 0:e.response)==null?void 0:a.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},se=async()=>{var a;const n={method:"GET",url:"api/product/product_lists",headers:{Authorization:`Bearer ${O("token")}`}};try{o.loading.show();const e=await E.request(n);H.value=e.data.products.map(l=>(l.label=l.name,l.value=l._id,l)),o.loading.hide()}catch(e){((a=e==null?void 0:e.response)==null?void 0:a.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},ne=async()=>{var a;const n={method:"GET",url:"api/unit/unit_lists",headers:{Authorization:`Bearer ${O("token")}`}};try{o.loading.show();const e=await E.request(n);ee.value=e.data.units.map(l=>(l.label=l.value,l.value=l._id,K.unit===l._id&&(K.unit=l),l)),o.loading.hide()}catch(e){((a=e==null?void 0:e.response)==null?void 0:a.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},ue=async()=>{var a;const n={method:"GET",url:"api/bank_account/bank_account_lists",headers:{Authorization:`Bearer ${O("token")}`}};try{o.loading.show();const e=await E.request(n);I.value=e.data.bankAccounts.map(l=>(l.label=l.name,l.value=l._id,B.value===l._id&&(B.value=l),l)),o.loading.hide()}catch(e){((a=e==null?void 0:e.response)==null?void 0:a.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},ie=()=>{A.value=Number(v.value)},re=async n=>{var h,g,b,y,i,U,D;n.preventDefault(),c.value={};const a={};(h=N.value)!=null&&h._id?a.supplier=(g=N.value)==null?void 0:g._id:c.value.supplier="Please Select A Supplier.",v.value&&v.value>=0&&(a.amount=v.value),(!be(v.value)||v.value==0)&&(c.value.headerWarning="Must buy one product and that must have a amount.",c.value.amount="Amount can't be zero (0)"),a.paidAmount=A.value,Q.value=="Bank"&&!((b=B.value)!=null&&b._id)&&(c.value.bankAccount="Please Select Bank Account.");const e={amount:A.value,type:Q.value,bankAccount:(y=B.value)==null?void 0:y._id,time:new Date};if(a.paymentDetails=JSON.stringify([...JSON.parse(JSON.stringify(te.value)),e]),a.dueAmount=R.value,a.products=JSON.stringify(m.value),Object.keys(c.value).length!==0)return;if(console.log(a),Object.keys(a).length<=0){o.notify({message:"Empty Form Submission Not Allowed",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]});return}const l={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${O("token")}`},data:a};l.method="post",l.url="api/purchase/purchase_lists";try{const x=await E.request(l);(i=j.query)!=null&&i.redirect?G.push(`/${(U=j.query)==null?void 0:U.redirect}`):G.push("/dashboard/purchase/purchase_list"),o.notify({message:"Updated Successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(x){((D=x==null?void 0:x.response)==null?void 0:D.status)==401?o.notify({message:x.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:x.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),console.error(x)}};return(n,a)=>(p(),me(ye,{padding:""},{default:_(()=>[xe,t("div",ke,[t("div",Ve,[s(M,{flat:"",bordered:"",class:J(["my-card mb-2",$(o).dark.isActive?"bg-grey-9":"bg-grey-2"])},{default:_(()=>[s(L,{class:"q-pb-none text-h6"},{default:_(()=>[we]),_:1}),s(L,null,{default:_(()=>{var e,l,h,g,b,y,i,U,D,x;return[t("div",null,[(e=d.value)!=null&&e.headerWarning?(p(),f("div",Ae,[t("span",null,r((l=d.value)==null?void 0:l.headerWarning),1)])):V("",!0),t("div",Pe,[s(z,{label:"Select an option for product ",placeholder:"Value",modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=k=>w.value=k),options:H.value,outlined:"",dense:""},null,8,["modelValue","options"]),(h=d.value)!=null&&h.product?(p(),f("div",qe,[t("span",null,r((g=d.value)==null?void 0:g.product),1)])):V("",!0)]),t("div",Se,[s(P,{label:"Purchase Rate *",type:"number",placeholder:"Purchase Rate",modelValue:q.value,"onUpdate:modelValue":[a[1]||(a[1]=k=>q.value=k),X],outlined:"",dense:""},null,8,["modelValue"]),(b=d.value)!=null&&b.price?(p(),f("div",Ne,[t("span",null,r((y=d.value)==null?void 0:y.price),1)])):V("",!0)]),t("div",Be,[s(P,{label:"Quantity *",type:"number",placeholder:"Quantity",modelValue:S.value,"onUpdate:modelValue":[a[2]||(a[2]=k=>S.value=k),X],outlined:"",dense:""},null,8,["modelValue"]),(i=d.value)!=null&&i.quantity?(p(),f("div",Le,[t("span",null,r((U=d.value)==null?void 0:U.quantity),1)])):V("",!0)]),t("div",Te,[s(P,{label:"Total *",type:"number",placeholder:"Total",modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=k=>C.value=k),outlined:"",disable:"",dense:""},null,8,["modelValue"])]),t("div",Ce,[s(P,{label:"Selling Rate *",type:"number",placeholder:"Selling",modelValue:T.value,"onUpdate:modelValue":a[4]||(a[4]=k=>T.value=k),outlined:"",dense:""},null,8,["modelValue"]),(D=d.value)!=null&&D.sellingPrice?(p(),f("div",Qe,[t("span",null,r((x=d.value)==null?void 0:x.sellingPrice),1)])):V("",!0)]),s(F,{label:"Add To Cart",color:"green",onClick:ae})])]}),_:1})]),_:1},8,["class"]),s(M,{flat:"",bordered:"",class:J(["my-card",$(o).dark.isActive?"bg-grey-9":"bg-grey-2"])},{default:_(()=>[s(L,{class:"q-pb-none text-h6"},{default:_(()=>[Ue]),_:1}),s(L,null,{default:_(()=>[t("div",null,[s(ge,{separator:"cell",flat:"",bordered:""},{default:_(()=>[De,t("tbody",null,[(p(!0),f(he,null,ve(m.value,(e,l)=>(p(),f("tr",null,[t("td",Ee,r(e==null?void 0:e.name),1),t("td",Oe,r(e==null?void 0:e.price),1),t("td",Re,r(e==null?void 0:e.quantity),1),t("td",Fe,r(e==null?void 0:e.total),1),t("td",ze,r(e==null?void 0:e.sellingPrice),1),t("td",Je,[s(F,{icon:"delete",color:"red",flat:"",dense:"",size:"md",onClick:()=>le(l)},null,8,["onClick"])])]))),256)),t("tr",null,[$e,t("td",Me,[t("span",je,r(m.value.reduce((e,l)=>Number(e)+Number(l.total),0)),1)]),Ge])])]),_:1})])]),_:1})]),_:1},8,["class"])]),t("div",We,[s(M,{flat:"",bordered:"",class:J(["my-card",$(o).dark.isActive?"bg-grey-9":"bg-grey-2"])},{default:_(()=>[s(L,{class:"q-pb-none text-h6"},{default:_(()=>[He]),_:1}),s(L,null,{default:_(()=>{var e,l,h,g,b,y;return[t("div",null,[t("div",Ie,[s(z,{label:"Select an option for Supplier ",placeholder:"Value",modelValue:N.value,"onUpdate:modelValue":a[5]||(a[5]=i=>N.value=i),options:W.value,outlined:"",dense:""},null,8,["modelValue","options"]),(e=c.value)!=null&&e.supplier?(p(),f("div",Ke,[t("span",null,r((l=c.value)==null?void 0:l.supplier),1)])):V("",!0)]),t("div",Xe,[s(P,{label:"Amount *",type:"number",placeholder:"Amount",modelValue:v.value,"onUpdate:modelValue":a[6]||(a[6]=i=>v.value=i),outlined:"",dense:"",disable:""},null,8,["modelValue"]),(h=c.value)!=null&&h.amount?(p(),f("div",Ye,[t("span",null,r((g=c.value)==null?void 0:g.amount),1)])):V("",!0)]),t("div",Ze,[s(P,{label:"Paid amount *",type:"number",placeholder:"Paid amount",modelValue:A.value,"onUpdate:modelValue":a[7]||(a[7]=i=>A.value=i),outlined:"",dense:""},null,8,["modelValue"])]),t("div",et,[s(P,{label:"Due ",type:"text",placeholder:"Due",modelValue:R.value,"onUpdate:modelValue":a[8]||(a[8]=i=>R.value=i),outlined:"",dense:"",disable:""},null,8,["modelValue"])]),t("div",tt,[s(z,{label:"Payment Type ",options:["Bank","Cash"],placeholder:"Due",modelValue:Q.value,"onUpdate:modelValue":a[9]||(a[9]=i=>Q.value=i),outlined:"",dense:""},null,8,["modelValue"])]),Q.value=="Bank"?(p(),f("div",at,[s(z,{label:"Select an option for Bank account ",placeholder:"Value",modelValue:B.value,"onUpdate:modelValue":a[10]||(a[10]=i=>B.value=i),options:I.value,outlined:"",dense:""},null,8,["modelValue","options"]),(b=c.value)!=null&&b.bankAccount?(p(),f("div",lt,[t("span",null,r((y=c.value)==null?void 0:y.bankAccount),1)])):V("",!0)])):V("",!0),t("div",ot,[t("div",st,[s(F,{label:"Full Payment",color:"cyan",onClick:ie})]),t("div",nt,[s(F,{label:n.$route.params.id==="create"?"Create Purchase":"Update Purchase",color:"green",onClick:re},null,8,["label"])])])])]}),_:1})]),_:1},8,["class"])])])]),_:1}))}};export{bt as default};
