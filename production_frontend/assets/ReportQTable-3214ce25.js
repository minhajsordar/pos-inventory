import{g as p,af as z,u as E,f as W,ac as $,E as j,o as D,e as Y,b,a as r,bg as w,ax as A,j as I,Q as S}from"./index-b55a7827.js";import{C as J,Q as M}from"./QSpace-f8c655d3.js";import{Q as q}from"./QTable-c3bf5ca2.js";import{u as H}from"./use-quasar-96558313.js";import{E as U,a as G}from"./jspdf.plugin.autotable-2f67a234.js";const K={id:"report-table-container"},X={class:"flex p-3 border border-1 border-gray-200"},Z={class:"q-gutter-sm"},ee={class:"flex p-3 border border-1 border-gray-200"},le={class:"flex gap-1 items-center"},te=b("span",null,"To",-1),oe={class:"flex gap-1"},ue={__name:"ReportQTable",props:{title:String,dataList:Array,columns:Array,page:Number,pages:Number,showEdit:Boolean,showDelete:Boolean},emits:["updatePaginate","onFilter","onEdit","onDelete"],setup(L,{emit:O}){const c=L,i=p("daily"),V=z(),R=E(),F=p([]),k=p([]),f=p([]),_=p("");p(!1),p(null);const a=W({keywords:null,gt:null,lt:null,gtValue:null,ltValue:null,filterColumn:null,rangeColumn:null}),x=()=>{const l=JSON.parse(JSON.stringify(a));l!=null&&l.gtValue&&(l.gtValue=Number(l.gtValue)-1),l!=null&&l.ltValue&&(l.ltValue=Number(l.ltValue)+1),O("onFilter",l),N(l)},Q=()=>{a.filterColumn=null,a.rangeColumn=null,a.keywords=null,a.gt=null,a.lt=null,a.gtValue=null,a.ltValue=null},B=()=>{Q(),x()};p([]),H(),$(()=>{k.value=c.columns.filter(l=>(l.summery&&l.summery==!0&&(_.value=l.field),l.field=="createdAt"||l.summery==!0)),F.value=c.columns.filter(l=>l.name!=="action"),a.filterColumn=c.columns.map(l=>l.name)[0],a.rangeColumn=c.columns.map(l=>l.name)[0]}),p({sortBy:"createdAt",descending:!0,page:c.page||1,rowsPerPage:10});const N=l=>{const e=new URLSearchParams(V.query),t={};for(const[m,n]of e)t[`${m}`]=n;const g=Object.keys(l);for(const m of g)t[`${m}`]=l[`${m}`];const y=new URLSearchParams(t);R.push(V.path+"?"+y.toString())};function C(l){if(console.log("exporting"),f.value.length<2)return;U.autoTableSetDefaults({headStyles:{fillColor:0}});const e=new U;e.setFontSize(18),e.text(c.title,14,22),e.setFontSize(11),e.setTextColor(10);let t=f.value[f.value.length-2].createdAt+" To "+f.value[0].createdAt;var g=e.internal.pageSize,y=g.width?g.width:g.getWidth(),m=e.splitTextToSize(t,y-35,{});e.text(m,14,30);const n=k.value.map(o=>o.field),s=k.value.filter(o=>n.includes(o.field)),u=[s.map(o=>o.label)],v=f.value.map(o=>s.map(d=>o[d.field]));if(G(e,{head:u,body:v,columnStyles:{...s.reduce((o,d,h)=>(o[h]={halign:d.align,fontSize:10},o),{})},headStyles:{...s.reduce((o,d,h)=>(o[h]={halign:d.align,fontSize:10,fillColor:null},o),{})},styles:{halign:"left",fontSize:10,lineWidth:.1},startY:35,showHead:"firstPage"}),l=="download")e.save("table.pdf");else if(l=="print"){const o=e.output("blob"),d=URL.createObjectURL(o);window.open(d)}else{const o=e.output("blob"),d=URL.createObjectURL(o),h=window.open(d);h.onload=()=>{URL.revokeObjectURL(d)}}}function P(l,e,t){const g=l.reduce((n,s)=>{if(typeof s.paidAmount!="number")return console.warn(`Invalid record skipped: ${JSON.stringify(s)}`),n;let u;const v=new Date(s.createdAt);if(e==="daily")u=v.toISOString().split("T")[0];else if(e==="weekly")u=`${v.getFullYear()}-W${T(v)}`;else if(e==="monthly")u=v.toISOString().slice(0,7);else if(e==="yearly")u=v.getFullYear().toString();else return console.error(`Invalid report type: ${e}. Expected "daily", "weekly", "monthly", or "yearly".`),n;return n[u]?n[u][t]+=s.paidAmount:n[u]={createdAt:u,[t]:s.paidAmount},n},{}),y=Object.values(g),m={createdAt:"Total",[t]:y.reduce((n,s)=>s[t]+n,0)};return[...y,m]}function T(l){const e=new Date(l.getFullYear(),0,1),t=(l-e+864e5)/864e5;return Math.ceil(t/7)}return j([()=>c.dataList,i],function(){f.value=P(c.dataList,i.value,_.value)}),(l,e)=>(D(),Y("div",K,[b("div",X,[b("div",Z,[r(w,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value=t),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"daily",label:"Daily Report"},null,8,["modelValue"]),r(w,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"weekly",label:"Weekly Report"},null,8,["modelValue"]),r(w,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value=t),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"monthly",label:"Monthly Report"},null,8,["modelValue"]),r(w,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value=t),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"yearly",label:"Yearly Report"},null,8,["modelValue"])])]),b("div",ee,[b("div",le,[r(A,{"model-value":a.gt,"onUpdate:modelValue":e[4]||(e[4]=t=>a.gt=t),outlined:"",dense:"",type:"date",debounce:"1000"},null,8,["model-value"]),te,r(A,{"model-value":a.lt,"onUpdate:modelValue":e[5]||(e[5]=t=>a.lt=t),outlined:"",dense:"",type:"date",debounce:"1000"},null,8,["model-value"]),I(r(S,{label:"Apply",color:"primary",onClick:x},null,512),[[J]]),r(S,{class:"q-ml-sm",icon:"clear",color:"red",onClick:B,dense:"",title:"clear filter"})]),r(M),b("div",oe,[r(S,{class:"q-px-sm",color:"cyan-8","icon-right":"archive","no-caps":"",onClick:e[6]||(e[6]=()=>C("download")),title:"Export as pdf"}),r(S,{label:"Print",color:"primary",onClick:e[7]||(e[7]=()=>C("print"))})])]),r(q,{class:"bg-grey-2 !rounded-none mt-3",title:c.title,flat:"",bordered:"",dense:"",rows:f.value,columns:k.value,separator:"cell","row-key":"name","hide-pagination":""},null,8,["title","rows","columns"])]))}};export{ue as _};
