import{f as T,g as d,af as $,u as j,ac as J,E as M,a1 as U,o as p,c as h,w as i,b as q,ai as w,Q as b,aj as N,a as u,h as G,au as P,d as I,av as H,j as V,aw as K}from"./index-b55a7827.js";import{Q as W}from"./QPage-615bd1f9.js";import{C as _}from"./QSpace-f8c655d3.js";import{u as X,a as v}from"./use-quasar-96558313.js";import{T as Y}from"./QTable-c3bf5ca2.js";import{a as c}from"./validationHelper-21a8e46b.js";import{u as Z,g as k}from"./userAuthStore-0c477450.js";import{_ as L}from"./CompactQTable-d15efe1b.js";import"./QMarkupTable-1fc170d9.js";import"./QList-f8bcfa4e.js";import"./QSelect-c33eb5ef.js";import"./QChip-1b4874fe.js";import"./QItemLabel-82cf5c84.js";import"./selection-af93f90a.js";import"./rtl-36dd996b.js";import"./format-6ceb96d6.js";const A={class:"w-full flex justify-end pb-3"},F={class:"relative overflow-x-auto shadow-md sm:rounded-lg"},ee=q("div",{class:"text-h6"},"Medium",-1),we={__name:"EmployeeView",setup(ae){const e=T({sortBy:"createdAt",descending:!0,page:1,rowsPerPage:10,keywords:null,gte:null,lte:null,gtValue:null,ltValue:null,filterColumn:null,rangeColumn:null}),t=d(null),r=X(),g=Z(),m=d(!1),y=d(null),O=d(!1),a=$(),S=j(),B=l=>{e.keywords=l.keywords,e.gt=l.gt,e.lt=l.lt,e.gtValue=l.gtValue,e.ltValue=l.ltValue,e.filterColumn=l.filterColumn,e.rangeColumn=l.rangeColumn},E=l=>{e.page=l.page,e.rowsPerPage=l.rowsPerPage,e.descending=l.descending,e.sortBy=l.sortBy||"createdAt"},x=l=>{S.push(`/dashboard/employee/employee_list/${l._id}`)},Q=l=>{y.value=l._id,m.value=!0},f=async()=>{var s;const l={method:"GET",url:"api/employee/employee_lists",headers:{Authorization:`Bearer ${k("token")}`},params:{pageNumber:(e==null?void 0:e.page)||1,pageSize:(e==null?void 0:e.rowsPerPage)||10,descending:e==null?void 0:e.descending,sortBy:(e==null?void 0:e.sortBy)||"createdAt",select:" name phone1 phone2 email address nidNo birthRegistrationNo fatherName motherName"}};e!=null&&e.keywords&&(l.params.keywords=e.keywords),e!=null&&e.gt&&(l.params.gt=e.gt),e!=null&&e.lt&&(l.params.lt=e.lt),c(e==null?void 0:e.gtValue)&&(l.params.gtValue=e.gtValue),c(e==null?void 0:e.ltValue)&&(l.params.ltValue=e.ltValue),e!=null&&e.filterColumn&&(l.params.filterColumn=e.filterColumn),e!=null&&e.rangeColumn&&(l.params.rangeColumn=e.rangeColumn),r.loading.show();try{const o=await v.request(l);t.value=o.data,r.loading.hide()}catch(o){console.log(o),r.loading.hide(),((s=o==null?void 0:o.response)==null?void 0:s.status)==401?r.notify({message:o.response.data.message+", Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):r.notify({message:o.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}};J(()=>{var l,s,o,n;a.query.hasOwnProperty("pageNumber")&&(e.pageNumber=Number((l=a.query)==null?void 0:l.pageNumber)),a.query.hasOwnProperty("pageSize")&&(e.pageSize=Number((s=a.query)==null?void 0:s.pageSize)),a.query.hasOwnProperty("descending")&&(e.descending=JSON.parse((o=a.query)==null?void 0:o.descending)),a.query.hasOwnProperty("sortBy")&&(e.sortBy=String((n=a.query)==null?void 0:n.sortBy)),a.query.hasOwnProperty("keywords")&&a.query.keywords&&a.query.keywords!=="null"&&(e.keywords=a.query.keywords),a.query.hasOwnProperty("gt")&&a.query.gt&&a.query.gt!=="null"&&(e.gt=String(a.query.gt)),a.query.hasOwnProperty("lt")&&a.query.lt&&a.query.lt!=="null"&&(e.lt=String(a.query.lt)),a.query.hasOwnProperty("gtValue")&&c(a.query.gtValue)&&(e.gtValue=Number(a.query.gtValue)),a.query.hasOwnProperty("ltValue")&&c(a.query.ltValue)&&(e.ltValue=Number(a.query.ltValue)),a.query.hasOwnProperty("filterColumn")&&a.query.filterColumn&&a.query.filterColumn!=="null"&&(e.filterColumn=String(a.query.filterColumn)),a.query.hasOwnProperty("rangeColumn")&&a.query.rangeColumn&&a.query.rangeColumn!=="null"&&(e.rangeColumn=String(a.query.rangeColumn)),f()}),M(e,U(f,1e3));const D=async()=>{var s;const l={method:"delete",url:"api/employee/employee_lists/"+y.value,headers:{Authorization:`Bearer ${k("token")}`}};try{r.loading.show(),await v.request(l);const o=t==null?void 0:t.value.employees.filter(n=>n._id!==y.value);t.value={...JSON.parse(JSON.stringify(t==null?void 0:t.value)),employees:o},(t==null?void 0:t.value.employees.length)<5&&(t==null?void 0:t.value.pages)!==1&&f(),r.loading.hide(),m.value=!1,r.notify({message:"Deleted successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(o){m.value=!1,((s=o==null?void 0:o.response)==null?void 0:s.status)==401?r.notify({message:o.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):r.notify({message:o.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),r.loading.hide(),console.error(o)}},z=[{name:"name",label:"Name",align:"left",field:"name",sortable:!0},{name:"phone1",label:"Phone1",align:"left",field:"phone1",sortable:!0},{name:"phone2",label:"Phone2",align:"left",field:"phone2",sortable:!0},{name:"email",label:"Email",align:"left",field:"email",sortable:!0},{name:"address",label:"Address",align:"left",field:"address",sortable:!0},{name:"nidNo",label:"Nid no",align:"left",field:"nidNo",sortable:!0},{name:"birthRegistrationNo",label:"Birth registration no",align:"left",field:"birthRegistrationNo",sortable:!0},{name:"fatherName",label:"Father name",align:"left",field:"fatherName",sortable:!0},{name:"motherName",label:"Mother name",align:"left",field:"motherName",sortable:!0},{name:"action",label:"Action",field:"action"}];return(l,s)=>(p(),h(W,{padding:""},{default:i(()=>{var o,n,C;return[q("div",A,[w(g).checkShowOnPermission("createEmployee")?(p(),h(b,{key:0,style:{background:"green",color:"white"},label:"New Employee",to:"/dashboard/employee/employee_list/create"})):N("",!0)]),q("div",F,[u(L,{columns:z,"data-list":((o=t.value)==null?void 0:o.employees)||[],page:((n=t.value)==null?void 0:n.page)||1,pages:((C=t.value)==null?void 0:C.pages)||1,onUpdatePaginate:E,onOnEdit:x,onOnDelete:Q,onOnFilter:B,showEdit:w(g).checkShowOnPermission("editEmployee"),showDelete:w(g).checkShowOnPermission("deleteEmployee")},null,8,["data-list","page","pages","showEdit","showDelete"]),O.value?(p(),h(Y,{key:0})):N("",!0)]),u(K,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=R=>m.value=R)},{default:i(()=>[u(G,{style:{width:"300px","max-width":"80vw"}},{default:i(()=>[u(P,null,{default:i(()=>[ee]),_:1}),u(P,{class:"q-pt-none"},{default:i(()=>[I(" Are you sure you want to delete this employee? ")]),_:1}),u(H,{align:"right",class:"bg-white text-teal"},{default:i(()=>[V(u(b,{flat:"",label:"Cancel"},null,512),[[_]]),V(u(b,{flat:"",label:"Delete",onClick:D,color:"red"},null,512),[[_]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}};export{we as default};
