import{af as z,u as D,g as V,f as A,ac as G,E as P,o as g,c as j,w as O,b as c,a as u,ax as _,e as f,ak as w,aj as y,Q as F}from"./index-b55a7827.js";import{Q as k}from"./QSelect-c33eb5ef.js";import{Q as I}from"./QPage-615bd1f9.js";import{u as J,a as b}from"./use-quasar-96558313.js";import{u as M,g as v}from"./userAuthStore-0c477450.js";import{e as q}from"./validationHelper-21a8e46b.js";import"./QChip-1b4874fe.js";import"./QItemLabel-82cf5c84.js";import"./selection-af93f90a.js";import"./rtl-36dd996b.js";import"./format-6ceb96d6.js";const H={class:"mb-6"},K={key:0,class:"text-red-8 text-xs q-pl-sm"},W={class:"mb-6"},X={key:0,class:"text-red-8 text-xs q-pl-sm"},Y={class:"mb-6"},Z={key:0,class:"text-red-8 text-xs q-pl-sm"},ee={class:"mb-6"},oe={key:0,class:"mb-6"},se={class:"mb-6"},ae={key:0,class:"text-red-8 text-xs q-pl-sm"},fe={__name:"EditRoleView",setup(te){const a=J();M();const m=z(),x=D(),n=V({}),B=V([]),L=V([]),S=V([]),o=A({name:"",slug:"",permissions:[],description:"",shop:"",branch:""}),h=A({name:"",slug:"",permissions:[],description:"",shop:"",branch:""}),C=async()=>{var s;if(m.params.id=="create"){E(),R();return}const r={method:"GET",url:"api/roles/"+m.params.id,headers:{Authorization:`Bearer ${v("token")}`}};try{a.loading.show();const e=await b.request(r);a.loading.hide(),o.name=e.data.name,h.name=e.data.name,o.slug=e.data.slug,h.slug=e.data.slug,o.permissions=e.data.permissions,h.permissions=e.data.permissions,o.description=e.data.description,h.description=e.data.description,o.shop=e.data.shop,h.shop=e.data.shop,o.branch=e.data.branch,h.branch=e.data.branch}catch(e){((s=e==null?void 0:e.response)==null?void 0:s.status)==401?a.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):a.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),a.loading.hide(),console.error(e)}finally{E(),R()}};G(()=>{C()});const R=async()=>{var s;const r={method:"GET",url:"api/shop/shop_lists",headers:{Authorization:`Bearer ${v("token")}`}};try{a.loading.show();const e=await b.request(r);L.value=e.data.shops.map(t=>(t.label=t.name,t.value=t._id,o.shop===t._id&&(o.shop=t),t)),a.loading.hide()}catch(e){((s=e==null?void 0:e.response)==null?void 0:s.status)==401?a.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):a.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),a.loading.hide(),console.error(e)}};P(()=>o.shop,function(){N()});const N=async()=>{var s,e;const r={method:"GET",url:"api/branch/branch_lists",headers:{Authorization:`Bearer ${v("token")}`},params:{keywords:typeof o.shop=="string"?o.shop:(s=o.shop)==null?void 0:s._id,filterColumn:"shop"}};try{a.loading.show();const t=await b.request(r);S.value=t.data.branchs.map(i=>(i.label=i.name,i.value=i._id,o.branch===i._id&&(o.branch=i),i)),a.loading.hide()}catch(t){((e=t==null?void 0:t.response)==null?void 0:e.status)==401?a.notify({message:t.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):a.notify({message:t.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),a.loading.hide(),console.error(t)}},E=async()=>{var s;const r={method:"GET",url:"api/permissions/",headers:{Authorization:`Bearer ${v("token")}`}};try{a.loading.show();const e=await b.request(r);a.loading.hide(),B.value=e.data.permissions,o.permissions=o.permissions.map(t=>{const i=e.data.permissions.find(l=>l==t),p={};return p.label=i,p.value=i,p})}catch(e){((s=e==null?void 0:e.response)==null?void 0:s.status)==401?a.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):a.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),a.loading.hide(),console.error(e)}finally{}},T=async r=>{var t,i,p;r.preventDefault(),n.value={};const s={};if(o.name&&(s.name=o.name),q(o.name)||(n.value.name="Required feild"),o.slug&&(s.slug=o.slug),q(o.slug)||(n.value.slug="Required feild"),o.permissions&&(s.permissions=JSON.stringify(o.permissions)),o.shop&&(s.shop=o.shop._id),o.branch&&(s.branch=o.branch._id),o.description&&(s.description=o.description),q(o.description)||(n.value.description="Required feild"),Object.keys(n.value).length!==0)return;if(console.log(s),Object.keys(s).length<=0){a.notify({message:"Empty Form Submission Not Allowed",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]});return}const e={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${v("token")}`},data:s};m.params.id=="create"?(e.method="post",e.url="api/roles"):(e.method="put",e.url="api/roles/"+m.params.id);try{const l=await b.request(e);(t=m.query)!=null&&t.redirect?x.push(`/${(i=m.query)==null?void 0:i.redirect}`):x.push("/dashboard/role/role_list"),a.notify({message:"Updated Successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(l){((p=l==null?void 0:l.response)==null?void 0:p.status)==401?a.notify({message:l.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):a.notify({message:l.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),console.error(l)}};return(r,s)=>(g(),j(I,{padding:""},{default:O(()=>{var e,t,i,p,l,U,Q,$;return[c("div",null,[c("div",H,[u(_,{label:"Name role",placeholder:"Value",modelValue:o.name,"onUpdate:modelValue":s[0]||(s[0]=d=>o.name=d),outlined:"",dense:""},null,8,["modelValue"]),(e=n.value)!=null&&e.name?(g(),f("div",K,[c("span",null,w((t=n.value)==null?void 0:t.name),1)])):y("",!0)]),c("div",W,[u(k,{label:"Select an option for Permission *",placeholder:"Value",modelValue:o.permissions,"onUpdate:modelValue":s[1]||(s[1]=d=>o.permissions=d),options:[...B.value],outlined:"",dense:"",multiple:"","use-chips":""},null,8,["modelValue","options"]),(i=n.value)!=null&&i.permissions?(g(),f("div",X,[c("span",null,w((p=n.value)==null?void 0:p.permissions),1)])):y("",!0)]),c("div",Y,[u(_,{label:"Slug *",placeholder:"Value",modelValue:o.slug,"onUpdate:modelValue":s[2]||(s[2]=d=>o.slug=d),outlined:"",dense:""},null,8,["modelValue"]),(l=n.value)!=null&&l.slug?(g(),f("div",Z,[c("span",null,w((U=n.value)==null?void 0:U.slug),1)])):y("",!0)]),c("div",ee,[u(k,{label:"Select an option for Shop ",placeholder:"Value",modelValue:o.shop,"onUpdate:modelValue":s[3]||(s[3]=d=>o.shop=d),options:L.value,outlined:"",dense:"","use-chips":""},null,8,["modelValue","options"])]),o.shop?(g(),f("div",oe,[u(k,{label:"Select an option for Branch ",placeholder:"Value",modelValue:o.branch,"onUpdate:modelValue":s[4]||(s[4]=d=>o.branch=d),options:S.value,outlined:"",dense:"","use-chips":""},null,8,["modelValue","options"])])):y("",!0),c("div",se,[u(_,{label:"Description role",placeholder:"Value",modelValue:o.description,"onUpdate:modelValue":s[5]||(s[5]=d=>o.description=d),outlined:"",dense:""},null,8,["modelValue"]),(Q=n.value)!=null&&Q.description?(g(),f("div",ae,[c("span",null,w(($=n.value)==null?void 0:$.description),1)])):y("",!0)]),u(F,{label:r.$route.params.id==="create"?"Create Role":"Update Role",color:"green",onClick:T},null,8,["label"])])]}),_:1}))}};export{fe as default};
