import{af as ke,u as we,g as r,f as ie,E as ue,ac as Ae,o as d,c as M,w as h,b as t,a as n,au as q,d as H,Q as C,e as g,ag as re,ah as ce,ak as c,n as j,ai as I,h as G,aj as k,ax as L,j as Ne,R as Ve}from"./index-b55a7827.js";import{Q as de}from"./QMarkupTable-1fc170d9.js";import{Q as Y}from"./QSelect-c33eb5ef.js";import{Q as Ee}from"./QPage-615bd1f9.js";import{u as Se,a as P}from"./use-quasar-96558313.js";import{u as qe,g as T}from"./userAuthStore-0c477450.js";import"./QChip-1b4874fe.js";import"./QItemLabel-82cf5c84.js";import"./selection-af93f90a.js";import"./rtl-36dd996b.js";import"./format-6ceb96d6.js";const Ce=t("div",{class:"p-0 text-h5 mb-2"}," Edit purchase ",-1),Le={class:"flex flex-wrap -m-1"},Pe={class:"w-3/5 p-1"},Te={class:"flex justify-between"},Be=t("div",null,"Payment List",-1),De=t("thead",null,[t("tr",{class:"bg-grey-3"},[t("th",{class:"text-left"},"Bank Account"),t("th",{class:"text-right"},"Payment Type"),t("th",{class:"text-right"},"Amount"),t("th",{class:"text-right"},"Time"),t("th",{class:"text-right"},"Action")])],-1),Oe={class:"text-left"},Ue={class:"text-right"},Qe={class:"text-right"},Fe={class:"text-right"},ze={class:"text-right"},Je=t("td",{class:"text-right",colspan:"2"},[t("span",{class:"text-h6"},"Due")],-1),Re={class:"text-right",colspan:"1"},$e={class:"text-h6"},je=t("td",{class:"text-left",colspan:"2"},null,-1),Ie={class:"flex justify-between"},Ge=t("div",null,"Expense Items",-1),We=t("thead",null,[t("tr",{class:"bg-grey-3"},[t("th",{class:"text-left"},"Name"),t("th",{class:"text-right"},"Expense Rate"),t("th",{class:"text-right"},"Quantity"),t("th",{class:"text-right"},"Total Price"),t("th",{class:"text-right"},"Selling Rate"),t("th",{class:"text-right"},"Action")])],-1),Me={class:"text-left"},He={class:"text-right"},Ye={class:"text-right"},Ke={class:"text-right"},Xe={class:"text-right"},Ze={class:"text-right"},et=t("td",{class:"text-right",colspan:"3"},[t("span",{class:"text-h6"},"Sub Total")],-1),tt={class:"text-right"},at={class:"text-h6"},st=t("td",{class:"text-left",colspan:"2"},null,-1),ot={class:"w-2/5 p-1"},lt=t("div",null,"Add/Edit Expense",-1),nt={key:0,class:"text-red-8 text-xs q-pl-sm mb-6"},it={class:"mb-6"},ut={key:0,class:"text-red-8 text-xs q-pl-sm"},rt={class:"mb-6"},ct={key:0,class:"text-red-8 text-xs q-pl-sm"},dt={class:"mb-6"},pt={key:0,class:"text-red-8 text-xs q-pl-sm"},mt={class:"mb-6"},ht=t("div",null,"Total",-1),vt={class:"mb-6"},gt={key:0,class:"text-red-8 text-xs q-pl-sm"},yt={class:"mb-6"},ft={key:0,class:"text-red-8 text-xs q-pl-sm"},_t={class:"mb-6"},bt={key:0,class:"text-red-8 text-xs q-pl-sm"},xt={class:"mb-6"},kt={class:"mb-6"},wt={key:0,class:"mb-6"},At={key:0,class:"text-red-8 text-xs q-pl-sm"},Nt={class:"flex -m-1"},Vt={class:"p-1"},Et={class:"p-1"},zt={__name:"EditExpenseView",setup(St){const o=Se();qe();const F=ke();we();const K=r([]),X=r([]),p=r([]),pe=r([]),b=r([]),Z=r([]),w=r(null),A=r(1),N=r(1),J=r(1),B=r(1),_=r({}),v=r({}),D=r(null),y=r(0),x=r(0),W=r(0),O=r(null),z=r("Bank"),R=r(!1),U=r(null),ee=ie({supplier:"",amount:"",paidAmount:"",duePaidList:"",quantity:"",unit:"",bankAccount:""}),Q=ie({supplier:"",amount:"",paidAmount:0,duePaidList:"",quantity:"",unit:"",bankAccount:""}),te=()=>{B.value=A.value*N.value},me=()=>{var s;const l={};if(w.value||(l.expense="Required Field. Select a expense"),A.value||(l.price="Required Field. Must be greater than 0."),N.value||(l.quantity="Required Field. Must be greater than 0."),Object.keys(l).length>0){_.value=l;return}const a={name:w.value,price:A.value,quantity:N.value,unit:(s=w.value)==null?void 0:s.unit,total:B.value,sellingPrice:J.value},e=[...JSON.parse(JSON.stringify(p.value))];U.value!==null?e[U.value]={...e[U.value],...a}:e.push(a),_.value={},w.value=null,A.value=1,N.value=1,B.value=1,J.value=1,o.dialog({title:"Confirm",message:"Would you like to add new expense to this purchase?",ok:{push:!0},cancel:{push:!0,color:"negative"},persistent:!0}).onOk(()=>{ne(e),U.value=null}).onCancel(()=>{}).onDismiss(()=>{})},he=l=>{const a=JSON.parse(JSON.stringify(p.value));a.splice(l,1),o.dialog({title:"Confirm",message:"Would you like to add new expense to this purchase?",ok:{push:!0},cancel:{push:!0,color:"negative"},persistent:!0}).onOk(()=>{ne(a)}).onCancel(()=>{}).onDismiss(()=>{})},ve=l=>{o.dialog({title:"Confirm",message:"Would you like to delete this payment?",ok:{push:!0},cancel:{push:!0,color:"negative"},persistent:!0}).onOk(()=>{const a=JSON.parse(JSON.stringify(b.value));a.splice(l,1),xe(a)}).onCancel(()=>{}).onDismiss(()=>{})},ge=l=>{X.value.forEach((a,e)=>{a._id==p.value[l].expense&&(a.value=a._id,a.label=a.name,w.value=a,U.value=l,R.value=!0,A.value=p.value[l].price,J.value=p.value[l].sellingPrice,N.value=p.value[l].quantity,B.value=p.value[l].total)})},ye=()=>{U.value=null,R.value=!1},fe=()=>{U.value=null,R.value=!0,w.value=null,A.value=1,N.value=1,B.value=1,J.value=1};ue([p,b],()=>{console.log("updating"),y.value=p.value.reduce((l,a)=>Number(l)+Number(a.total),0)-b.value.reduce((l,a)=>Number(l)+Number(a.amount),0)}),ue([y,x,p,b],()=>{W.value=y.value-x.value});const $=async()=>{var a;if(F.params.id=="create"){ae(),oe(),le(),se();return}const l={method:"GET",url:"api/expense/expense_lists/"+F.params.id,headers:{Authorization:`Bearer ${T("token")}`}};try{o.loading.show();const e=await P.request(l);o.loading.hide(),D.value=e.data.supplier,p.value=e.data.itemList,Q.supplier=e.data.supplier,y.value=e.data.amount,Q.amount=e.data.amount,x.value=Number(e.data.amount)-Number(e.data.paidAmount),Q.paidAmount=e.data.paidAmount,b.value=e.data.paymentDetails,Q.duePaidList=e.data.duePaidList,O.value=e.data.bankAccount,Q.bankAccount=e.data.bankAccount}catch(e){((a=e==null?void 0:e.response)==null?void 0:a.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}finally{ae(),oe(),le(),se()}};Ae(()=>{$()});const ae=async()=>{var a;const l={method:"GET",url:"api/supplier/supplier_lists",headers:{Authorization:`Bearer ${T("token")}`}};try{o.loading.show();const e=await P.request(l);K.value=e.data.suppliers.map(s=>(s.label=s.companyName,s.value=s._id,D.value===s._id&&(D.value=s),s)),o.loading.hide()}catch(e){((a=e==null?void 0:e.response)==null?void 0:a.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},se=async()=>{var a;const l={method:"GET",url:"api/expense/expense_lists",headers:{Authorization:`Bearer ${T("token")}`}};try{o.loading.show();const e=await P.request(l);X.value=e.data.expenses.map(s=>(s.label=s.name,s.value=s._id,s)),o.loading.hide()}catch(e){((a=e==null?void 0:e.response)==null?void 0:a.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},oe=async()=>{var a;const l={method:"GET",url:"api/unit/unit_lists",headers:{Authorization:`Bearer ${T("token")}`}};try{o.loading.show();const e=await P.request(l);pe.value=e.data.units.map(s=>(s.label=s.value,s.value=s._id,ee.unit===s._id&&(ee.unit=s),s)),o.loading.hide()}catch(e){((a=e==null?void 0:e.response)==null?void 0:a.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},le=async()=>{var a;const l={method:"GET",url:"api/bank_account/bank_account_lists",headers:{Authorization:`Bearer ${T("token")}`}};try{o.loading.show();const e=await P.request(l);Z.value=e.data.bankAccounts.map(s=>(s.label=s.name,s.value=s._id,O.value===s._id&&(O.value=s),s)),o.loading.hide()}catch(e){((a=e==null?void 0:e.response)==null?void 0:a.status)==401?o.notify({message:e.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:e.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),o.loading.hide(),console.error(e)}},_e=()=>{x.value=Number(y.value)},be=async l=>{var i,f,V,E,S;l.preventDefault(),v.value={};const a={};(i=D.value)!=null&&i._id?a.supplier=(f=D.value)==null?void 0:f._id:v.value.supplier="Please Select A Supplier.",y.value||(v.value.amount="You don't have any due amount"),Number(y.value)<Number(x.value)&&(v.value.payAmount="Amount can't be greater than due amount"),a.paidAmount=Number(x.value)+Number(b.value.reduce((m,u)=>Number(m)+Number(u.amount),0)),z.value=="Bank"&&!((V=O.value)!=null&&V._id)&&(v.value.bankAccount="Please Select Bank Account.");const e={amount:x.value,type:z.value,bankAccount:(E=O.value)==null?void 0:E._id,time:new Date};if(a.paymentDetails=JSON.stringify([...JSON.parse(JSON.stringify(b.value)),e]),Object.keys(v.value).length!==0)return;if(console.log(a),Object.keys(a).length<=0){o.notify({message:"Empty Form Submission Not Allowed",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]});return}const s={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${T("token")}`},data:a};s.method="put",s.url="api/expense/expense_lists/"+F.params.id;try{const m=await P.request(s);$(),o.notify({message:"Updated Successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(m){((S=m==null?void 0:m.response)==null?void 0:S.status)==401?o.notify({message:m.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:m.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),console.error(m)}},xe=async l=>{var s;const a={};if(a.paidAmount=Number(l.reduce((i,f)=>Number(i)+Number(f.amount),0)),a.paymentDetails=JSON.stringify(l),Object.keys(a).length<=0){o.notify({message:"Empty Form Submission Not Allowed",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]});return}const e={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${T("token")}`},data:a};e.method="put",e.url="api/expense/expense_lists/"+F.params.id;try{const i=await P.request(e);o.notify({message:"Updated Successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(i){((s=i==null?void 0:i.response)==null?void 0:s.status)==401?o.notify({message:i.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:i.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),console.error(i)}finally{await $()}},ne=async l=>{var s;const a={};if(a.itemList=JSON.stringify(l),a.amount=l.reduce((i,f)=>Number(i)+Number(f.total),0),Object.keys(a).length<=0){o.notify({message:"Empty Form Submission Not Allowed",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]});return}const e={headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${T("token")}`},data:a};e.method="put",e.url="api/expense/expense_lists/"+F.params.id;try{const i=await P.request(e);o.notify({message:"Updated Successfully!",color:"primary",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]})}catch(i){((s=i==null?void 0:i.response)==null?void 0:s.status)==401?o.notify({message:i.response.data.message+". Login to try again.",color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}):o.notify({message:i.message,color:"red",position:"top",actions:[{icon:"close",color:"white",handler:()=>{}}]}),console.error(i)}finally{await $()}};return(l,a)=>(d(),M(Ee,{padding:""},{default:h(()=>[Ce,t("div",Le,[t("div",Pe,[n(G,{flat:"",bordered:"",class:j(["my-card mb-2",[I(o).dark.isActive?"bg-grey-9":"bg-grey-2",y.value==0?"opacity-60 pointer-events-none":""]])},{default:h(()=>[n(q,{class:"q-pb-none text-h6"},{default:h(()=>[t("div",Te,[Be,H(),n(C,{onClick:ye,label:"Add Payment",color:"orange"})])]),_:1}),n(q,null,{default:h(()=>[t("div",null,[n(de,{separator:"cell",flat:"",bordered:""},{default:h(()=>[De,t("tbody",null,[(d(!0),g(ce,null,re(b.value,(e,s)=>(d(),g("tr",null,[t("td",Oe,c(e==null?void 0:e.bankAccount),1),t("td",Ue,c(e==null?void 0:e.type),1),t("td",Qe,c(e==null?void 0:e.amount),1),t("td",Fe,c(e==null?void 0:e.time),1),t("td",ze,[n(C,{icon:"delete",color:"red",flat:"",dense:"",size:"md",onClick:()=>ve(s)},null,8,["onClick"])])]))),256)),t("tr",null,[Je,t("td",Re,[t("span",$e,c(Number(Q.amount)-b.value.reduce((e,s)=>Number(e)+Number(s.amount),0)),1)]),je])])]),_:1})])]),_:1})]),_:1},8,["class"]),n(G,{flat:"",bordered:"",class:j(["my-card",I(o).dark.isActive?"bg-grey-9":"bg-grey-2"])},{default:h(()=>[n(q,{class:"q-pb-none text-h6"},{default:h(()=>[t("div",Ie,[Ge,H(),n(C,{onClick:fe,label:"Add Item",color:"orange"})])]),_:1}),n(q,null,{default:h(()=>[t("div",null,[n(de,{separator:"cell",flat:"",bordered:""},{default:h(()=>[We,t("tbody",null,[(d(!0),g(ce,null,re(p.value,(e,s)=>(d(),g("tr",null,[t("td",Me,[H(c(e==null?void 0:e.name)+" ",1),n(L,{"model-value":p.value[s].name,"onUpdate:modelValue":i=>p.value[s].name=i,flat:"",borderless:""},null,8,["model-value","onUpdate:modelValue"])]),t("td",He,c(e==null?void 0:e.price),1),t("td",Ye,c(e==null?void 0:e.quantity),1),t("td",Ke,c(e==null?void 0:e.total),1),t("td",Xe,c(e==null?void 0:e.sellingPrice),1),t("td",Ze,[n(C,{icon:"edit",color:"green",flat:"",dense:"",size:"md",onClick:()=>ge(s)},null,8,["onClick"]),n(C,{icon:"delete",color:"red",flat:"",dense:"",size:"md",onClick:()=>he(s)},null,8,["onClick"])])]))),256)),t("tr",null,[et,t("td",tt,[t("span",at,c(p.value.reduce((e,s)=>Number(e)+Number(s.total),0)),1)]),st])])]),_:1})])]),_:1})]),_:1},8,["class"])]),t("div",ot,[R.value?(d(),M(G,{key:0,flat:"",bordered:"",class:j(["my-card mb-2",I(o).dark.isActive?"bg-grey-9":"bg-grey-2"])},{default:h(()=>[n(q,{class:"q-pb-none text-h6"},{default:h(()=>[lt]),_:1}),n(q,null,{default:h(()=>{var e,s,i,f,V,E,S,m;return[t("div",null,[(e=_.value)!=null&&e.headerWarning?(d(),g("div",nt,[t("span",null,c((s=_.value)==null?void 0:s.headerWarning),1)])):k("",!0),t("div",it,[n(L,{label:"Item name ",placeholder:"Expense item name",modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=u=>w.value=u),outlined:"",dense:""},null,8,["modelValue"]),(i=_.value)!=null&&i.expense?(d(),g("div",ut,[t("span",null,c((f=_.value)==null?void 0:f.expense),1)])):k("",!0)]),t("div",rt,[n(L,{label:"Expense Rate *",type:"number",placeholder:"Expense Rate",modelValue:A.value,"onUpdate:modelValue":[a[1]||(a[1]=u=>A.value=u),te],outlined:"",dense:""},null,8,["modelValue"]),(V=_.value)!=null&&V.price?(d(),g("div",ct,[t("span",null,c((E=_.value)==null?void 0:E.price),1)])):k("",!0)]),t("div",dt,[n(L,{label:"Quantity *",type:"number",placeholder:"Quantity",modelValue:N.value,"onUpdate:modelValue":[a[2]||(a[2]=u=>N.value=u),te],outlined:"",dense:""},null,8,["modelValue"]),(S=_.value)!=null&&S.quantity?(d(),g("div",pt,[t("span",null,c((m=_.value)==null?void 0:m.quantity),1)])):k("",!0)]),t("div",mt,[n(L,{label:"Total *",type:"number",placeholder:"Total",modelValue:B.value,"onUpdate:modelValue":a[3]||(a[3]=u=>B.value=u),outlined:"",disable:"",dense:""},null,8,["modelValue"])]),n(C,{label:"Add To Cart",color:"green",onClick:me})])]}),_:1})]),_:1},8,["class"])):(d(),M(G,{key:1,flat:"",bordered:"",class:j(["my-card",[I(o).dark.isActive?"bg-grey-9":"bg-grey-2",y.value==0?"opacity-60 pointer-events-none":""]])},{default:h(()=>[n(q,{class:"q-pb-none text-h6"},{default:h(()=>[ht]),_:1}),n(q,null,{default:h(()=>{var e,s,i,f,V,E,S,m;return[t("div",null,[t("div",vt,[n(Y,{label:"Select an option for Supplier ",placeholder:"Value",modelValue:D.value,"onUpdate:modelValue":a[4]||(a[4]=u=>D.value=u),options:K.value,outlined:"",dense:""},null,8,["modelValue","options"]),(e=v.value)!=null&&e.supplier?(d(),g("div",gt,[t("span",null,c((s=v.value)==null?void 0:s.supplier),1)])):k("",!0)]),t("div",yt,[n(L,{label:"Amount *",type:"number",placeholder:"Amount",modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=u=>y.value=u),outlined:"",dense:"",disable:""},null,8,["modelValue"]),(i=v.value)!=null&&i.amount?(d(),g("div",ft,[t("span",null,c((f=v.value)==null?void 0:f.amount),1)])):k("",!0)]),t("div",_t,[n(L,{label:"Pay amount *",type:"number",placeholder:"Paid amount",modelValue:x.value,"onUpdate:modelValue":a[6]||(a[6]=u=>x.value=u),outlined:"",dense:""},null,8,["modelValue"]),(V=v.value)!=null&&V.payAmount?(d(),g("div",bt,[t("span",null,c((E=v.value)==null?void 0:E.payAmount),1)])):k("",!0)]),t("div",xt,[n(L,{label:"Due ",type:"text",placeholder:"Due",modelValue:W.value,"onUpdate:modelValue":a[7]||(a[7]=u=>W.value=u),outlined:"",dense:"",disable:""},null,8,["modelValue"])]),t("div",kt,[n(Y,{label:"Payment Type ",options:["Bank","Cash"],placeholder:"Due",modelValue:z.value,"onUpdate:modelValue":a[8]||(a[8]=u=>z.value=u),outlined:"",dense:""},null,8,["modelValue"])]),z.value=="Bank"?(d(),g("div",wt,[n(Y,{label:"Select an option for Bank account ",placeholder:"Value",modelValue:O.value,"onUpdate:modelValue":a[9]||(a[9]=u=>O.value=u),options:Z.value,outlined:"",dense:""},null,8,["modelValue","options"]),(S=v.value)!=null&&S.bankAccount?(d(),g("div",At,[t("span",null,c((m=v.value)==null?void 0:m.bankAccount),1)])):k("",!0)])):k("",!0),Ne(t("div",Nt,[t("div",Vt,[n(C,{label:"Full Payment",color:"cyan",onClick:_e})]),t("div",Et,[n(C,{label:l.$route.params.id==="create"?"Create Expense":"Update Expense",color:"green",onClick:be},null,8,["label"])])],512),[[Ve,y.value!==0]])])]}),_:1})]),_:1},8,["class"]))])])]),_:1}))}};export{zt as default};
